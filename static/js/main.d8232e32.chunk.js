(this.webpackJsonpslideshow=this.webpackJsonpslideshow||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/missing.a7a5b39c.png"},,,function(e,t,n){e.exports=n(31)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(15),r=n.n(i),o=(n(24),n(6)),l=n(2),c=n(1),u=n(3),h=n(5),d=n(4),p=n(7),g=n.n(p),f=n(11),v=n(12),m=n.n(v),k=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"storeLogin",value:function(e,t){window.localStorage.setItem("username",e),window.localStorage.setItem("api_key",t)}},{key:"removeLogin",value:function(){window.localStorage.removeItem("username"),window.localStorage.removeItem("api_key")}},{key:"authParameters",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e&&null!==t?{login:e,api_key:t}:{}}},{key:"authHeaders",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e||null!==t?{Authorization:"Basic "+btoa(e+":"+t)}:{}}},{key:"username",get:function(){return window.localStorage.getItem("username")}}]),e}(),y=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"_getURLAddons",value:function(){return Object(o.a)({_client:"Ilm's Slideshow/2.0"},k.authParameters)}},{key:"getPosts",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,a,s,i,r,l,c,u,h,d,p,f,v=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=v.length>0&&void 0!==v[0]?v[0]:{},a=n.tags,s=void 0===a?"":a,i=n.page,r=void 0===i?1:i,l=n.limit,c=void 0===l?null:l,u=n.success,h=void 0===u?function(){}:u,d=n.failure,p=void 0===d?function(){}:d,f={tags:s,page:r},null!==c&&(f.limit=c),m.a.ajax({type:"GET",url:"https://e621.net/posts.json",data:Object(o.a)(Object(o.a)({},f),e._getURLAddons()),success:h,failure:p});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"addPostToSet",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,a,s,i,r,l,c,u,h,d,p=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=p.length>0&&void 0!==p[0]?p[0]:{},a=n.post_id,s=void 0===a?null:a,i=n.set_id,r=void 0===i?null:i,l=n.success,c=void 0===l?function(){}:l,u=n.failure,h=void 0===u?function(){}:u,null!==s&&null!==r&&""!==r){t.next=4;break}return setTimeout((function(){h()}),0),t.abrupt("return");case 4:d={"post_ids[]":s},m.a.ajax({type:"POST",url:"https://e621.net/post_sets/"+r+"/add_posts.json",data:Object(o.a)(Object(o.a)({},d),e._getURLAddons()),success:c,failure:h,error:h});case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getUser",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,a,s,i,r,o,l=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>0&&void 0!==l[0]?l[0]:{},a=n.user,s=n.success,i=void 0===s?function(){}:s,r=n.failure,o=void 0===r?function(){}:r,a){t.next=4;break}return setTimeout((function(){o()}),0),t.abrupt("return");case 4:m.a.ajax({type:"GET",url:"https://e621.net/users/"+a+".json",data:e._getURLAddons(),success:i,failure:o});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getSets",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,a,s,i,r,o=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=o.length>0&&void 0!==o[0]?o[0]:{},a=n.success,s=void 0===a?function(){}:a,i=n.failure,r=void 0===i?function(){}:i,m.a.ajax({type:"GET",url:"https://e621.net/post_sets/for_select.json",data:e._getURLAddons(),success:s,failure:r,error:r});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),e}(),b=n(8),w=function(){function e(t){Object(l.a)(this,e),this.apiJson=t}return Object(c.a)(e,[{key:"_bypassURL",value:function(t){return e.bypassDefaultBlacklist?"https://static1.e621.net/data/"+t+this.md5.substring(0,2)+"/"+this.md5.substring(2,4)+"/"+this.md5+"."+(""!==t?"jpg":this.fileExtension):null}}]),Object(c.a)(e,[{key:"getAlternate",value:function(e,t){if(e=e.toLowerCase(),t=t.toLowerCase(),!this._alternatesJson.hasOwnProperty(e))return null;switch(t){case"webm":return this._alternatesJson[e].urls[0]||this.fileURL;case"mp4":return this._alternatesJson[e].urls[1]||this.fileURL;default:return null}}},{key:"getTagsInGroup",value:function(e){return this.apiJson.tags.hasOwnProperty(e)?this.apiJson.tags[e]:null}},{key:"link",get:function(){return"https://e621.net/posts/"+this.apiJson.id}},{key:"id",get:function(){return this.apiJson.id}},{key:"md5",get:function(){return this.apiJson.file.md5}},{key:"width",get:function(){return this.apiJson.file.width}},{key:"height",get:function(){return this.apiJson.file.height}},{key:"fileSize",get:function(){return this.apiJson.file.size}},{key:"fileExtension",get:function(){return this.apiJson.file.ext}},{key:"isBlocked",get:function(){return null===this.apiJson.file.url}},{key:"fileURL",get:function(){return this.apiJson.file.url||this._bypassURL("")}},{key:"previewURL",get:function(){return this.apiJson.preview.url||("swf"===this.fileExtension?"https://static1.e621.net/images/download-preview.png":this._bypassURL("preview/"))}},{key:"hasSample",get:function(){return this.apiJson.sample.has}},{key:"sampleURL",get:function(){return this.apiJson.sample.url||this._bypassURL(!0===this.hasSample?"sample/":"")}},{key:"hasAlternates",get:function(){return this.alternateSizes.length}},{key:"_alternatesJson",get:function(){return this.apiJson.sample.alternates}},{key:"alternateSizes",get:function(){return Object.keys(this._alternatesJson)}},{key:"score",get:function(){return this.apiJson.score.total}},{key:"upvotes",get:function(){return this.apiJson.score.up}},{key:"downvotes",get:function(){return this.apiJson.score.down}},{key:"rating",get:function(){return this.apiJson.rating}},{key:"tags",get:function(){return[].concat(Object(b.a)(this.getTagsInGroup("artist")),Object(b.a)(this.getTagsInGroup("copyright")),Object(b.a)(this.getTagsInGroup("character")),Object(b.a)(this.getTagsInGroup("species")),Object(b.a)(this.getTagsInGroup("general")),Object(b.a)(this.getTagsInGroup("meta")),Object(b.a)(this.getTagsInGroup("lore")),Object(b.a)(this.getTagsInGroup("invalid")))}},{key:"favCount",get:function(){return this.apiJson.fav_count}},{key:"sources",get:function(){return this.apiJson.sources}},{key:"poolIDs",get:function(){return this.apiJson.pools}},{key:"parentID",get:function(){return this.apiJson.relationships.parent_id}},{key:"hasChildren",get:function(){return this.apiJson.relationships.has_children}},{key:"hasActiveChildren",get:function(){return this.apiJson.relationships.has_active_children}},{key:"childIDs",get:function(){return this.apiJson.relationships.children}},{key:"description",get:function(){return this.apiJson.description}},{key:"commentCount",get:function(){return this.apiJson.comment_count}},{key:"favorited",get:function(){return this.apiJson.is_favorited}},{key:"duration",get:function(){return this.apiJson.duration}}]),e}();w.bypassDefaultBlacklist=!0;var S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Object(l.a)(this,e),this.limit=t,this.ready=!0,this.queue=[]}return Object(c.a)(e,[{key:"add",value:function(e){this.queue.push(e),this.processQueue()}},{key:"processQueue",value:function(){this.queue.length>0&&this.ready&&(this.ready=!1,this.queue.shift()(),setTimeout(this.refresh.bind(this),this.limit))}},{key:"refresh",value:function(){this.ready=!0,this.processQueue()}}]),e}(),_=function(){function e(t){Object(l.a)(this,e),this.tags=t,this.limit=100,this._page=1,this._fetching=!1,this._finished=!1}return Object(c.a)(e,[{key:"fetch",value:function(t){if(!0===this._finished)return setTimeout((function(){t([])}),0),!0;if(!0===this._fetching)return!1;this._fetching=!0;var n={tags:this.tags,page:this._page,limit:this.limit,success:this._fetchSuccess.bind(this,t)};return e.queue.add((function(){y.getPosts(n)})),this._page++,!0}},{key:"_fetchSuccess",value:function(e,t){if(this._fetching=!1,0===t.posts.length)this._finished=!0,e([]);else{for(var n=[],a=0;a<t.posts.length;++a)n.push(new w(t.posts[a]));e(n)}}},{key:"finished",get:function(){return this._finished}}]),e}();_.queue=new S(1e3);var j=n(18),O=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.label,n=Object(j.a)(e,["label"]);return s.a.createElement(s.a.Fragment,null,s.a.createElement("h2",null,t),s.a.createElement("input",n))}}]),n}(s.a.Component),x=(n(26),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleTagsChange=a.handleTagsChange.bind(Object(u.a)(a)),a.handleTagsKey=a.handleTagsKey.bind(Object(u.a)(a)),a.search=a.search.bind(Object(u.a)(a)),a.state={tags:""},a}return Object(c.a)(n,[{key:"render",value:function(){return s.a.createElement("div",{className:"form filter-form"},s.a.createElement(O,{label:"Tags",type:"text",onChange:this.handleTagsChange,onKeyPress:this.handleTagsKey}),s.a.createElement("button",{onClick:this.search},"Search"),s.a.createElement("button",{onClick:this.props.escape},"Close"))}},{key:"handleTagsChange",value:function(e){this.setState({tags:e.target.value})}},{key:"handleTagsKey",value:function(e){"Enter"===e.key&&(e.target.blur(),this.search())}},{key:"search",value:function(){var e={tags:this.state.tags};this.props.searchCallback(e)}}]),n}(s.a.Component)),C=n(9),E=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleLocalChange=a.handleLocalChange.bind(Object(u.a)(a)),a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSaveLogin=a.handleSaveLogin.bind(Object(u.a)(a)),a.fetchBlacklist=a.fetchBlacklist.bind(Object(u.a)(a)),a.state=n.initialState,a.fetchBlacklist(),a.fetchSets(),a}return Object(c.a)(n,[{key:"render",value:function(){return s.a.createElement("div",{className:"form settings-form"},s.a.createElement("button",{onClick:this.props.close},"Close Settings"),s.a.createElement(O,{label:"Username",type:"text",name:"username",value:this.state.username,onChange:this.handleLocalChange}),s.a.createElement(O,{label:"API Key",type:"password",name:"apiKey",value:this.state.apiKey,onChange:this.handleLocalChange}),s.a.createElement("button",{id:"e621-save-login-button",onClick:this.handleSaveLogin},"Store Login Locally"),s.a.createElement(O,{label:"Avoid Anon Blacklist",type:"checkbox",name:"avoidAnonBlacklist",checked:this.state.avoidAnonBlacklist,onChange:this.handleChange}),s.a.createElement("h2",null,"Blacklist"),s.a.createElement("button",{id:"fetch-user-blacklist-button",onClick:this.fetchBlacklist},"Get blacklist"),s.a.createElement("textarea",{name:"userBlacklist",value:this.state.userBlacklist,onChange:this.handleChange}),s.a.createElement("h2",null,"Selected Set"),this._getSetSelection(),s.a.createElement("button",{onClick:this.props.close},"Close Settings"))}},{key:"handleLocalChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(C.a)({},t.name,n))}},{key:"handleChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(C.a)({},t.name,n)),this.props.onSettingsChange(Object(C.a)({},t.name,n))}},{key:"handleSaveLogin",value:function(){k.storeLogin(this.state.username,this.state.apiKey),this.setState({username:"",apiKey:""}),this.fetchBlacklist(),this.fetchSets()}},{key:"fetchBlacklist",value:function(){var e=this._setBlacklist.bind(this),t=k.username;y.getUser({user:t,success:function(n){n.hasOwnProperty("blacklisted_tags")?e(n.blacklisted_tags):e("(error_not_logged_in:"+t+")")},failure:function(){e("(error_invalid_user:"+t+")")}})}},{key:"_setBlacklist",value:function(e){this.setState({userBlacklist:e}),this.props.onSettingsChange({userBlacklist:e})}},{key:"fetchSets",value:function(){var e=this.setState.bind(this);y.getSets({success:function(t){e({sets:t})},failure:function(){e({sets:n._defaultSets()})}})}},{key:"_getSetSelection",value:function(){return s.a.createElement("select",{name:"setID",value:this.state.setID,onChange:this.handleChange},s.a.createElement("optgroup",{label:"Owned"},this._getSetSelectionGroup(this.state.sets.Owned)),s.a.createElement("optgroup",{label:"Maintained"},this._getSetSelectionGroup(this.state.sets.Maintained)))}},{key:"_getSetSelectionGroup",value:function(e){for(var t=[],n=0;n<e.length;++n)t.push(this._getSetSelectionOption(e[n][0],e[n][1]));return t}},{key:"_getSetSelectionOption",value:function(e,t){return s.a.createElement("option",{value:t,key:t},e)}}],[{key:"_defaultSets",value:function(){return{Owned:[],Maintained:[]}}},{key:"initialState",get:function(){return{username:"",apiKey:"",userBlacklist:"",avoidAnonBlacklist:!1,setID:"",sets:n._defaultSets()}}}]),n}(s.a.Component),P=(n(27),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e="card";return e+=" content-type-"+this.props.post.fileExtension,s.a.createElement("div",{className:e},s.a.createElement("button",{onClick:this.props.callback},s.a.createElement("img",{src:this.props.post.previewURL,alt:""})))}}]),n}(s.a.Component)),T=(n(28),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return s.a.createElement("div",{className:"gallery"},s.a.createElement("div",{className:"gallery-controls"},s.a.createElement("button",{onClick:this.props.openSearch},"Search"),s.a.createElement("button",{onClick:this.props.openSettings},"Settings")),s.a.createElement("div",{className:"gallery-controls"},s.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),s.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")),s.a.createElement("div",{className:"gallery-content"},this.getCards()),s.a.createElement("div",{className:"gallery-controls"},s.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),s.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")))}},{key:"getCards",value:function(){var e=this,t=[];if(this.props.postManager)for(var n=this.props.postManager.getAllPosts(),a=function(a){t.push(s.a.createElement(P,{key:n[a].id,post:n[a],callback:function(){e.props.viewPost(a)}}))},i=0;i<n.length;i++)a(i);return t}}]),n}(s.a.Component)),I=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return s.a.createElement("div",{style:{display:"none"}},this.getImages(this.props.posts))}},{key:"getImages",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(s.a.createElement("img",{key:e[n].id,alt:"",src:"webm"===e[n].fileExtension?e[n].sampleURL:e[n].fileURL}));return t}}]),n}(s.a.Component),L=(n(29),n(16)),J=n.n(L),M=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={removeSetText:"\u2796",addSetText:"\u2795"},a.removeFromSet=a.removeFromSet.bind(Object(u.a)(a)),a.addToSet=a.addToSet.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"render",value:function(){var e="slide-wrapper";return this.props.post&&(e+=" content-type-"+this.props.post.fileExtension),s.a.createElement("div",{className:e},s.a.createElement("div",{className:"slide"},this.getSlideContents()),s.a.createElement("div",{className:"slide-controls"},s.a.createElement("button",{className:"prev-button",onClick:this.props.prev},"Previous"),s.a.createElement("button",{className:"escape-button",onClick:this.props.escape},"Close"),s.a.createElement("a",{className:"source-button",href:this.props.post?this.props.post.link:null,target:"_blank",rel:"noopener noreferrer"},"Link"),s.a.createElement("button",{className:"next-button",onClick:this.props.next},"Next")),s.a.createElement("div",{className:"slide-controls-extra"},s.a.createElement("button",{className:"add-set-button",onClick:this.addToSet},this.state.addSetText)))}},{key:"componentDidMount",value:function(){this.onNewPost()}},{key:"componentDidUpdate",value:function(e){e.post!==this.props.post&&this.onNewPost()}},{key:"onNewPost",value:function(){this.setState({removeSetText:"\u2796",addSetText:"\u2795"})}},{key:"removeFromSet",value:function(){}},{key:"addToSet",value:function(){var e=this.setState.bind(this);e({addSetText:"\ud83d\udd04"}),this.props.addToSet({success:function(){e({addSetText:"\u2714\ufe0f"})},failure:function(){e({addSetText:"\u274c"})}})}},{key:"getSlideContents",value:function(){if(this.props.post)switch(this.props.post.fileExtension){case"jpg":case"png":case"gif":return s.a.createElement("img",{className:"current-image",key:this.props.post.id,src:this.props.post.fileURL,alt:""});case"webm":return this.getVideoElement()}return s.a.createElement("img",{className:"current-image",src:J.a,alt:""})}},{key:"getVideoElement",value:function(){return s.a.createElement("video",{className:"current-video",key:this.props.post.id,width:this.props.post.width,height:this.props.post.height,poster:this.props.post.sampleURL,controls:!0},s.a.createElement("source",{src:this.props.post.getAlternate("original","webm"),type:"video/webm"}),s.a.createElement("source",{src:this.props.post.getAlternate("original","mp4"),type:"video/mp4"}),"Your browser does not support the video tag, or cannot handle webm or mp4 files.")}}]),n}(s.a.Component),N=n(17),A=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"matches",value:function(e){return!1}},{key:"toString",value:function(){return""}}],[{key:"_registerMetatagClass",value:function(t){e._metatagClasses[t.name]=t}},{key:"getMetatag",value:function(t){if(!t.includes(":"))return null;var n=t.split(":",1),a=Object(N.a)(n,2),s=a[0],i=a[1];return e._metatagClasses.hasOwnProperty(s)?new e._metatagClasses[s](i):null}},{key:"isMetatag",value:function(e){for(var t=0;t<B.length;++t)if(e.startsWith(B[t]+":"))return!0;return!1}},{key:"name",get:function(){return""}}]),e}();A._metatagClasses={};var B=["user","favoritedby","voted","votedup","voteddown","approvedby","deletedby","id","score","favcount","comment_count","tagcount","gentags","arttags","chartags","copytags","spectags","invtags","width","height","mpixels","ratio","filesize","duration","date","rating","type","source","description","notes","delreason","ischild","isparent","parent","status","hassource","hasdescription","ratinglocked","notelocked","hideanon","hidegoogle","inpool","pool","set","md5","order"],U=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"approve",value:function(e){return!0}}],[{key:"_includesTag",value:function(e,t){return e.tags.includes(t)}},{key:"_includesAllTags",value:function(e,t){for(var n=0;n<t.length;++n)if(!this._includesTag(e,t[n]))return!1;return!0}},{key:"_excludesAllTags",value:function(e,t){for(var n=0;n<t.length;++n)if(this._includesTag(e,t[n]))return!1;return!0}},{key:"_includesAnyTag",value:function(e,t){if(0===t.length)return!0;for(var n=0;n<t.length;++n)if(this._includesTag(e,t[n]))return!0;return!1}},{key:"_includesAllMetatags",value:function(e,t){for(var n=0;n<t.length;++n)if(!t[n].matches(e))return!1;return!0}},{key:"_excludesAllMetatags",value:function(e,t){for(var n=0;n<t.length;++n)if(t[n].matches(e))return!1;return!0}},{key:"_getExcludeTag",value:function(e){return e.startsWith("-")&&e.length>1?e.substring(1):null}},{key:"_getWildcardTag",value:function(e){return e.startsWith("~")&&e.length>1?e.substring(1):null}},{key:"_isInvalidTag",value:function(e){return""===e||("-"===e||("~"===e||!!/[%,#\\* ]/.test(e)))}},{key:"_sortTags",value:function(t){for(var n={includeTags:[],excludeTags:[],wildcardTags:[],includeMetatags:[],excludeMetatags:[]},a=t.split(/\s+/),s=0;s<a.length;s++)if(!e._isInvalidTag(a[s])){var i=e._getExcludeTag(a[s]);if(null===i){var r=e._getWildcardTag(a[s]);if(null===r)if(A.isMetatag(a[s])){var o=A.getMetatag(a[s]);if(null!==o){n.includeMetatags.push(o);continue}}else n.includeTags.push(a[s]);else n.wildcardTags.push(r)}else{if(A.isMetatag(i)){var l=A.getMetatag(i);if(null!==l){n.excludeMetatags.push(l);continue}continue}n.excludeTags.push(i)}}return n}}]),e}(),G=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this)).blacklist=e,a}return Object(c.a)(n,[{key:"approve",value:function(e){for(var t=0;t<this._lines.length;++t)if(n._match(e,this._lines[t]))return!1;return!0}},{key:"blacklist",set:function(e){this._lines=[];for(var t=e.split(/\n+/),n=0;n<t.length;++n){var a=U._sortTags(t[n]);0!==a.includeTags.length&&0!==a.excludeTags.length&&0!==a.wildcardTags.length&&0!==a.includeMetatags.length&&0!==a.excludeMetatags.length&&this._lines.push(a)}}}],[{key:"_match",value:function(e,t){return U._includesAllTags(e,t.includeTags)&&U._excludesAllTags(e,t.excludeTags)&&U._includesAnyTag(e,t.wildcardTags)&&U._includesAllMetatags(e,t.includeMetatags)&&U._excludesAllMetatags(e,t.excludeMetatags)}}]),n}(U),R=function(){function e(t,n){Object(l.a)(this,e),this.fetcher=t,this.posts={},this.order=[],this.pages=[],this.pageLocations={},this.currentPostIndex=null,this.currentPageIndex=null,this.blacklistFilter=new G(n),this.lookahead=!1,this.maxLookahead=2e3,this.validExtensions=new Set(["png","jpg","gif","webm"])}return Object(c.a)(e,[{key:"empty",value:function(){this.posts={},this.order=[],this.pages=[],this.pageLocations={},this.currentPostIndex=null,this.currentPageIndex=null}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._fetch(e)}},{key:"_fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};!1===this.fetcher.finished&&this.fetcher.fetch(this._fetchCallback.bind(this,e))}},{key:"_fetchIfNeeded",value:function(){null!==this.currentPostIndex&&this.currentPostIndex>=this.order.length-20&&this._fetch()}},{key:"_fetchCallback",value:function(e,t){0===t.length?e&&e(!1):(this._addPosts(t),e&&e(!0),this.lookahead&&this.order.length<this.maxLookahead&&this._fetch())}},{key:"_isPostAllowed",value:function(e){return!!this.validExtensions.has(e.fileExtension)&&!!this.blacklistFilter.approve(e)}},{key:"_addPosts",value:function(e){for(var t=[],n=this.pages.length,a=0;a<e.length;a++){var s=e[a];this._isPostAllowed(s)&&(this.posts[s.id]=s,this.order.push(s.id),t.push(s.id),this.pageLocations[s.id]=n)}this.pages.push(t)}},{key:"moveToStart",value:function(){this.currentPostIndex=0}},{key:"moveTo",value:function(e){this.currentPostIndex=e}},{key:"next",value:function(){if(null!==this.currentPostIndex){this.currentPostIndex++;var e=this.order.length;return this.currentPostIndex>=e?(this.currentPostIndex=e>0?e-1:0,!1):(this._fetchIfNeeded(),!0)}}},{key:"prev",value:function(){if(null!==this.currentPostIndex)return this.currentPostIndex--,!(this.currentPostIndex<0)||(this.currentPostIndex=0,!1)}},{key:"getPostById",value:function(e){return this.posts[e]}},{key:"getPostByIndex",value:function(e){return this.posts[this.order[e]]}},{key:"getAllPosts",value:function(){for(var e=[],t=0;t<this.order.length;t++)e.push(this.posts[this.order[t]]);return e}},{key:"getCurrentPost",value:function(){return null!==this.currentPostIndex?this.getPostByIndex(this.currentPostIndex):null}},{key:"getCachePosts",value:function(e,t){var n=[];if(null!==this.currentPostIndex){var a=this.currentPostIndex-t,s=this.currentPostIndex+e;a<0&&(a=0),s>=this.order.length&&(s=this.order.length-1);for(var i=a;i<=s;i++)n.push(this.getPostByIndex(i))}return n}}]),e}(),D=(n(30),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).search=a.search.bind(Object(u.a)(a)),a.searchCallback=a.searchCallback.bind(Object(u.a)(a)),a.openSlideshow=a.openSlideshow.bind(Object(u.a)(a)),a.openGallery=a.openGallery.bind(Object(u.a)(a)),a.slideshowNext=a.slideshowNext.bind(Object(u.a)(a)),a.slideshowPrev=a.slideshowPrev.bind(Object(u.a)(a)),a.keydownHandler=a.keydownHandler.bind(Object(u.a)(a)),a.openSearch=a.openSearch.bind(Object(u.a)(a)),a.openSettings=a.openSettings.bind(Object(u.a)(a)),a.galleryViewPost=a.galleryViewPost.bind(Object(u.a)(a)),a.addToSet=a.addToSet.bind(Object(u.a)(a)),a.onSettingsChange=a.onSettingsChange.bind(Object(u.a)(a)),a.state={mode:"search",api:"e621",settings:E.initialState,currentCache:[],slideshowPost:null,posts:[],postManager:null},a}return Object(c.a)(n,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"search"===this.state.mode?"mount show":"mount"},s.a.createElement(x,{searchCallback:this.search,escape:this.openGallery})),s.a.createElement("div",{className:"slideshow"===this.state.mode?"mount show":"mount"},s.a.createElement(M,{post:this.state.slideshowPost,next:this.slideshowNext,prev:this.slideshowPrev,escape:this.openGallery,addToSet:this.addToSet})),s.a.createElement("div",{className:"gallery"===this.state.mode?"mount show":"mount"},s.a.createElement(T,{postManager:this.state.postManager,openSearch:this.openSearch,openSettings:this.openSettings,viewPost:this.galleryViewPost})),s.a.createElement("div",{className:"settings"===this.state.mode?"mount show":"mount"},s.a.createElement(E,{close:this.openGallery,onSettingsChange:this.onSettingsChange})),s.a.createElement(I,{posts:this.state.currentCache}))}},{key:"keydownHandler",value:function(e){if("slideshow"===this.state.mode)switch(e.which||e.keyCode){case 37:case 65:return void this.slideshowPrev();case 39:case 68:return void this.slideshowNext();default:return}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keydownHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydownHandler)}},{key:"search",value:function(e){var t=new R(new _(e.tags,30),this.state.settings.userBlacklist);t.start(this.searchCallback),this.setState({mode:"gallery",postManager:t})}},{key:"update",value:function(){this.setState({posts:this.state.postManager.getAllPosts(),currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}},{key:"searchCallback",value:function(){this.update()}},{key:"openSearch",value:function(){this.setState({mode:"search"})}},{key:"openSlideshow",value:function(){this.setState({mode:"slideshow"})}},{key:"openGallery",value:function(){this.setState({mode:"gallery"})}},{key:"openSettings",value:function(){this.setState({mode:"settings"})}},{key:"slideshowNext",value:function(){this.state.postManager.next(),this.update()}},{key:"slideshowPrev",value:function(){this.state.postManager.prev(),this.update()}},{key:"galleryViewPost",value:function(e){this.state.postManager.moveTo(e),this.update(),this.setState({mode:"slideshow"})}},{key:"addToSet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.success,n=void 0===t?function(){}:t,a=e.failure,s=void 0===a?function(){}:a,i=this.state.postManager.getCurrentPost();y.addPostToSet({post_id:i.id,set_id:this.state.settings.setID,success:n,failure:s})}},{key:"onSettingsChange",value:function(e){this.setState((function(t){return{settings:Object(o.a)(Object(o.a)({},t.settings),e)}}))}}]),n}(s.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[19,1,2]]]);
//# sourceMappingURL=main.d8232e32.chunk.js.map