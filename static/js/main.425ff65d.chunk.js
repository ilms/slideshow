(this.webpackJsonpslideshow=this.webpackJsonpslideshow||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/missing.a7a5b39c.png"},,,function(e,t,n){e.exports=n(31)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),i=n(15),r=n.n(i),o=(n(24),n(6)),l=n(2),c=n(1),u=n(3),h=n(5),d=n(4),p=n(7),g=n.n(p),f=n(11),v=n(12),m=n.n(v),y=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"storeLogin",value:function(e,t){window.localStorage.setItem("username",e),window.localStorage.setItem("api_key",t)}},{key:"removeLogin",value:function(){window.localStorage.removeItem("username"),window.localStorage.removeItem("api_key")}},{key:"authParameters",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e&&null!==t?{login:e,api_key:t}:{}}},{key:"authHeaders",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e||null!==t?{Authorization:"Basic "+btoa(e+":"+t)}:{}}},{key:"username",get:function(){return window.localStorage.getItem("username")}}]),e}(),k=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"_getURLAddons",value:function(){return Object(o.a)({_client:"Ilm's Slideshow/2.0"},y.authParameters)}},{key:"getPosts",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,l,c,u,h,d,p,f,v=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=v.length>0&&void 0!==v[0]?v[0]:{},s=n.tags,a=void 0===s?"":s,i=n.page,r=void 0===i?1:i,l=n.limit,c=void 0===l?null:l,u=n.success,h=void 0===u?function(){}:u,d=n.failure,p=void 0===d?function(){}:d,f={tags:a,page:r},null!==c&&(f.limit=c),m.a.ajax({type:"GET",url:"https://e621.net/posts.json",data:Object(o.a)(Object(o.a)({},f),e._getURLAddons()),success:h,failure:p});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"addPostToSet",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,l,c,u,h,d,p=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=p.length>0&&void 0!==p[0]?p[0]:{},s=n.post_id,a=void 0===s?null:s,i=n.set_id,r=void 0===i?null:i,l=n.success,c=void 0===l?function(){}:l,u=n.failure,h=void 0===u?function(){}:u,null!==a&&null!==r&&""!==r){t.next=4;break}return setTimeout((function(){h()}),0),t.abrupt("return");case 4:d={"post_ids[]":a},m.a.ajax({type:"POST",url:"https://e621.net/post_sets/"+r+"/add_posts.json",data:Object(o.a)(Object(o.a)({},d),e._getURLAddons()),success:c,failure:h,error:h});case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getUser",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,o,l=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>0&&void 0!==l[0]?l[0]:{},s=n.user,a=n.success,i=void 0===a?function(){}:a,r=n.failure,o=void 0===r?function(){}:r,s){t.next=4;break}return setTimeout((function(){o()}),0),t.abrupt("return");case 4:m.a.ajax({type:"GET",url:"https://e621.net/users/"+s+".json",data:e._getURLAddons(),success:i,failure:o});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getSets",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,o=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=o.length>0&&void 0!==o[0]?o[0]:{},s=n.success,a=void 0===s?function(){}:s,i=n.failure,r=void 0===i?function(){}:i,m.a.ajax({type:"GET",url:"https://e621.net/post_sets/for_select.json",data:e._getURLAddons(),success:a,failure:r,error:r});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),e}(),b=n(8),w=function(){function e(t){Object(l.a)(this,e),this.apiJson=t}return Object(c.a)(e,[{key:"_bypassURL",value:function(t){return e.bypassDefaultBlacklist?"https://static1.e621.net/data/"+t+this.md5.substring(0,2)+"/"+this.md5.substring(2,4)+"/"+this.md5+"."+(""!==t?"jpg":this.fileExtension):null}}]),Object(c.a)(e,[{key:"getAlternate",value:function(e,t){if(e=e.toLowerCase(),t=t.toLowerCase(),!this._alternatesJson.hasOwnProperty(e))return null;switch(t){case"webm":return this._alternatesJson[e].urls[0]||this.fileURL;case"mp4":return this._alternatesJson[e].urls[1]||this.fileURL;default:return null}}},{key:"getTagsInGroup",value:function(e){return this.apiJson.tags.hasOwnProperty(e)?this.apiJson.tags[e]:null}},{key:"link",get:function(){return"https://e621.net/posts/"+this.apiJson.id}},{key:"id",get:function(){return this.apiJson.id}},{key:"md5",get:function(){return this.apiJson.file.md5}},{key:"width",get:function(){return this.apiJson.file.width}},{key:"height",get:function(){return this.apiJson.file.height}},{key:"fileSize",get:function(){return this.apiJson.file.size}},{key:"fileExtension",get:function(){return this.apiJson.file.ext}},{key:"isBlocked",get:function(){return null===this.apiJson.file.url}},{key:"fileURL",get:function(){return this.apiJson.file.url||this._bypassURL("")}},{key:"previewURL",get:function(){return this.apiJson.preview.url||("swf"===this.fileExtension?"https://static1.e621.net/images/download-preview.png":this._bypassURL("preview/"))}},{key:"hasSample",get:function(){return this.apiJson.sample.has}},{key:"sampleURL",get:function(){return this.apiJson.sample.url||this._bypassURL(!0===this.hasSample?"sample/":"")}},{key:"hasAlternates",get:function(){return this.alternateSizes.length}},{key:"_alternatesJson",get:function(){return this.apiJson.sample.alternates}},{key:"alternateSizes",get:function(){return Object.keys(this._alternatesJson)}},{key:"score",get:function(){return this.apiJson.score.total}},{key:"upvotes",get:function(){return this.apiJson.score.up}},{key:"downvotes",get:function(){return this.apiJson.score.down}},{key:"rating",get:function(){return this.apiJson.rating}},{key:"tags",get:function(){return[].concat(Object(b.a)(this.getTagsInGroup("artist")),Object(b.a)(this.getTagsInGroup("copyright")),Object(b.a)(this.getTagsInGroup("character")),Object(b.a)(this.getTagsInGroup("species")),Object(b.a)(this.getTagsInGroup("general")),Object(b.a)(this.getTagsInGroup("meta")),Object(b.a)(this.getTagsInGroup("lore")),Object(b.a)(this.getTagsInGroup("invalid")))}},{key:"favCount",get:function(){return this.apiJson.fav_count}},{key:"sources",get:function(){return this.apiJson.sources}},{key:"poolIDs",get:function(){return this.apiJson.pools}},{key:"parentID",get:function(){return this.apiJson.relationships.parent_id}},{key:"hasChildren",get:function(){return this.apiJson.relationships.has_children}},{key:"hasActiveChildren",get:function(){return this.apiJson.relationships.has_active_children}},{key:"childIDs",get:function(){return this.apiJson.relationships.children}},{key:"description",get:function(){return this.apiJson.description}},{key:"commentCount",get:function(){return this.apiJson.comment_count}},{key:"favorited",get:function(){return this.apiJson.is_favorited}},{key:"duration",get:function(){return this.apiJson.duration}}]),e}();w.bypassDefaultBlacklist=!0;var S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Object(l.a)(this,e),this.limit=t,this.ready=!0,this.queue=[]}return Object(c.a)(e,[{key:"add",value:function(e){this.queue.push(e),this.processQueue()}},{key:"processQueue",value:function(){this.queue.length>0&&this.ready&&(this.ready=!1,this.queue.shift()(),setTimeout(this.refresh.bind(this),this.limit))}},{key:"refresh",value:function(){this.ready=!0,this.processQueue()}}]),e}(),_=function(){function e(t){Object(l.a)(this,e),this.tags=t,this.limit=100,this._page=1,this._fetching=!1,this._finished=!1}return Object(c.a)(e,[{key:"fetch",value:function(t){if(!0===this._finished)return setTimeout((function(){t([])}),0),!0;if(!0===this._fetching)return!1;this._fetching=!0;var n={tags:this.tags,page:this._page,limit:this.limit,success:this._fetchSuccess.bind(this,t)};return e.queue.add((function(){k.getPosts(n)})),this._page++,!0}},{key:"_fetchSuccess",value:function(e,t){if(this._fetching=!1,0===t.posts.length)this._finished=!0,e([]);else{for(var n=[],s=0;s<t.posts.length;++s)n.push(new w(t.posts[s]));e(n)}}},{key:"finished",get:function(){return this._finished}}]),e}();_.queue=new S(1e3);var j=n(18),O=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.label,n=Object(j.a)(e,["label"]);return a.a.createElement(a.a.Fragment,null,a.a.createElement("h2",null,t),a.a.createElement("input",n))}}]),n}(a.a.Component),x=(n(26),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this,e)).handleTagsChange=s.handleTagsChange.bind(Object(u.a)(s)),s.handleTagsKey=s.handleTagsKey.bind(Object(u.a)(s)),s.search=s.search.bind(Object(u.a)(s)),s.state={tags:""},s}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"form filter-form"},a.a.createElement(O,{label:"Tags",type:"text",onChange:this.handleTagsChange,onKeyPress:this.handleTagsKey}),a.a.createElement("button",{onClick:this.search},"Search"),a.a.createElement("button",{onClick:this.props.escape},"Close"))}},{key:"handleTagsChange",value:function(e){this.setState({tags:e.target.value})}},{key:"handleTagsKey",value:function(e){"Enter"===e.key&&(e.target.blur(),this.search())}},{key:"search",value:function(){var e={tags:this.state.tags};this.props.searchCallback(e)}}]),n}(a.a.Component)),C=n(9),P=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this,e)).handleLocalChange=s.handleLocalChange.bind(Object(u.a)(s)),s.handleChange=s.handleChange.bind(Object(u.a)(s)),s.handleSaveLogin=s.handleSaveLogin.bind(Object(u.a)(s)),s.fetchBlacklist=s.fetchBlacklist.bind(Object(u.a)(s)),s.state=n.initialState,s.fetchBlacklist(),s.fetchSets(),s}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"form settings-form"},a.a.createElement("button",{onClick:this.props.close},"Close Settings"),a.a.createElement(O,{label:"Username",type:"text",name:"username",value:this.state.username,onChange:this.handleLocalChange}),a.a.createElement(O,{label:"API Key",type:"password",name:"apiKey",value:this.state.apiKey,onChange:this.handleLocalChange}),a.a.createElement("button",{id:"e621-save-login-button",onClick:this.handleSaveLogin},"Store Login Locally"),a.a.createElement(O,{label:"Avoid Anon Blacklist",type:"checkbox",name:"avoidAnonBlacklist",checked:this.state.avoidAnonBlacklist,onChange:this.handleChange}),a.a.createElement("h2",null,"Blacklist"),a.a.createElement("button",{id:"fetch-user-blacklist-button",onClick:this.fetchBlacklist},"Get blacklist"),a.a.createElement("textarea",{name:"userBlacklist",value:this.state.userBlacklist,onChange:this.handleChange}),a.a.createElement("h2",null,"Selected Set"),this._getSetSelection(),a.a.createElement("button",{onClick:this.props.close},"Close Settings"))}},{key:"componentDidUpdate",value:function(e,t){if(t.sets!==this.state.sets){var n=this.state.sets.Owned,s=this.state.sets.Maintained,a=n.concat(s);a.length>0?this.setState({setID:a[0][1]}):this.setState({setID:""})}}},{key:"handleLocalChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(C.a)({},t.name,n))}},{key:"handleChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(C.a)({},t.name,n)),this.props.onSettingsChange(Object(C.a)({},t.name,n))}},{key:"handleSaveLogin",value:function(){y.storeLogin(this.state.username,this.state.apiKey),this.setState({username:"",apiKey:""}),this.fetchBlacklist(),this.fetchSets()}},{key:"fetchBlacklist",value:function(){var e=this._setBlacklist.bind(this),t=y.username;k.getUser({user:t,success:function(n){n.hasOwnProperty("blacklisted_tags")?e(n.blacklisted_tags):e("(error_not_logged_in:"+t+")")},failure:function(){e("(error_invalid_user:"+t+")")}})}},{key:"_setBlacklist",value:function(e){this.setState({userBlacklist:e}),this.props.onSettingsChange({userBlacklist:e})}},{key:"fetchSets",value:function(){var e=this.setState.bind(this);k.getSets({success:function(t){e({sets:t})},failure:function(){e({sets:n._defaultSets()})}})}},{key:"_getSetSelection",value:function(){return a.a.createElement("select",{name:"setID",value:this.state.setID,onChange:this.handleChange},a.a.createElement("optgroup",{label:"Owned"},this._getSetSelectionGroup(this.state.sets.Owned)),a.a.createElement("optgroup",{label:"Maintained"},this._getSetSelectionGroup(this.state.sets.Maintained)))}},{key:"_getSetSelectionGroup",value:function(e){for(var t=[],n=0;n<e.length;++n)t.push(this._getSetSelectionOption(e[n][0],e[n][1]));return t}},{key:"_getSetSelectionOption",value:function(e,t){return a.a.createElement("option",{value:t,key:t},e)}}],[{key:"_defaultSets",value:function(){return{Owned:[],Maintained:[]}}},{key:"initialState",get:function(){return{username:"",apiKey:"",userBlacklist:"",avoidAnonBlacklist:!1,setID:"",sets:n._defaultSets()}}}]),n}(a.a.Component),E=(n(27),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e="card";return e+=" content-type-"+this.props.post.fileExtension,a.a.createElement("div",{className:e},a.a.createElement("button",{onClick:this.props.callback},a.a.createElement("img",{src:this.props.post.previewURL,alt:""})))}}]),n}(a.a.Component)),T=(n(28),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"gallery"},a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.openSearch},"Search"),a.a.createElement("button",{onClick:this.props.openSettings},"Settings")),a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),a.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")),a.a.createElement("div",{className:"gallery-content"},this.getCards()),a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),a.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")))}},{key:"getCards",value:function(){var e=this,t=[];if(this.props.postManager)for(var n=this.props.postManager.getAllPosts(),s=function(s){t.push(a.a.createElement(E,{key:n[s].id,post:n[s],callback:function(){e.props.viewPost(s)}}))},i=0;i<n.length;i++)s(i);return t}}]),n}(a.a.Component)),I=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{style:{display:"none"}},this.getImages(this.props.posts))}},{key:"getImages",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(a.a.createElement("img",{key:e[n].id,alt:"",src:"webm"===e[n].fileExtension?e[n].sampleURL:e[n].fileURL}));return t}}]),n}(a.a.Component),L=(n(29),n(16)),M=n.n(L),J=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this,e)).state={removeSetText:"\u2796",addSetText:"\u2795"},s.removeFromSet=s.removeFromSet.bind(Object(u.a)(s)),s.addToSet=s.addToSet.bind(Object(u.a)(s)),s}return Object(c.a)(n,[{key:"render",value:function(){var e="slide-wrapper";return this.props.post&&(e+=" content-type-"+this.props.post.fileExtension),a.a.createElement("div",{className:e},a.a.createElement("div",{className:"slide"},this.getSlideContents()),a.a.createElement("div",{className:"slide-controls"},a.a.createElement("button",{className:"prev-button",onClick:this.props.prev},"Previous"),a.a.createElement("button",{className:"escape-button",onClick:this.props.escape},"Close"),a.a.createElement("a",{className:"source-button",href:this.props.post?this.props.post.link:null,target:"_blank",rel:"noopener noreferrer"},"Link"),a.a.createElement("button",{className:"next-button",onClick:this.props.next},"Next")),a.a.createElement("div",{className:"slide-controls-extra"},a.a.createElement("button",{className:"add-set-button",onClick:this.addToSet},this.state.addSetText)))}},{key:"componentDidMount",value:function(){this.onNewPost()}},{key:"componentDidUpdate",value:function(e){e.post!==this.props.post&&this.onNewPost()}},{key:"onNewPost",value:function(){this.setState({removeSetText:"\u2796",addSetText:"\u2795"})}},{key:"removeFromSet",value:function(){}},{key:"addToSet",value:function(){var e=this.setState.bind(this);e({addSetText:"\ud83d\udd04"}),this.props.addToSet({success:function(){e({addSetText:"\u2714\ufe0f"})},failure:function(){e({addSetText:"\u274c"})}})}},{key:"getSlideContents",value:function(){if(this.props.post)switch(this.props.post.fileExtension){case"jpg":case"png":case"gif":return a.a.createElement("img",{className:"current-image",key:this.props.post.id,src:this.props.post.fileURL,alt:""});case"webm":return this.getVideoElement()}return a.a.createElement("img",{className:"current-image",src:M.a,alt:""})}},{key:"getVideoElement",value:function(){return a.a.createElement("video",{className:"current-video",key:this.props.post.id,width:this.props.post.width,height:this.props.post.height,poster:this.props.post.sampleURL,controls:!0},a.a.createElement("source",{src:this.props.post.getAlternate("original","webm"),type:"video/webm"}),a.a.createElement("source",{src:this.props.post.getAlternate("original","mp4"),type:"video/mp4"}),"Your browser does not support the video tag, or cannot handle webm or mp4 files.")}}]),n}(a.a.Component),N=n(17),A=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"matches",value:function(e){return!1}},{key:"toString",value:function(){return""}}],[{key:"_registerMetatagClass",value:function(t){e._metatagClasses[t.name]=t}},{key:"getMetatag",value:function(t){if(!t.includes(":"))return null;var n=t.split(":",1),s=Object(N.a)(n,2),a=s[0],i=s[1];return e._metatagClasses.hasOwnProperty(a)?new e._metatagClasses[a](i):null}},{key:"isMetatag",value:function(e){for(var t=0;t<B.length;++t)if(e.startsWith(B[t]+":"))return!0;return!1}},{key:"name",get:function(){return""}}]),e}();A._metatagClasses={};var B=["user","favoritedby","voted","votedup","voteddown","approvedby","deletedby","id","score","favcount","comment_count","tagcount","gentags","arttags","chartags","copytags","spectags","invtags","width","height","mpixels","ratio","filesize","duration","date","rating","type","source","description","notes","delreason","ischild","isparent","parent","status","hassource","hasdescription","ratinglocked","notelocked","hideanon","hidegoogle","inpool","pool","set","md5","order"],U=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"approve",value:function(e){return!0}}],[{key:"_includesTag",value:function(e,t){return e.tags.includes(t)}},{key:"_includesAllTags",value:function(e,t){for(var n=0;n<t.length;++n)if(!this._includesTag(e,t[n]))return!1;return!0}},{key:"_excludesAllTags",value:function(e,t){for(var n=0;n<t.length;++n)if(this._includesTag(e,t[n]))return!1;return!0}},{key:"_includesAnyTag",value:function(e,t){if(0===t.length)return!0;for(var n=0;n<t.length;++n)if(this._includesTag(e,t[n]))return!0;return!1}},{key:"_includesAllMetatags",value:function(e,t){for(var n=0;n<t.length;++n)if(!t[n].matches(e))return!1;return!0}},{key:"_excludesAllMetatags",value:function(e,t){for(var n=0;n<t.length;++n)if(t[n].matches(e))return!1;return!0}},{key:"_getExcludeTag",value:function(e){return e.startsWith("-")&&e.length>1?e.substring(1):null}},{key:"_getWildcardTag",value:function(e){return e.startsWith("~")&&e.length>1?e.substring(1):null}},{key:"_isInvalidTag",value:function(e){return""===e||("-"===e||("~"===e||!!/[%,#\\* ]/.test(e)))}},{key:"_sortTags",value:function(t){for(var n={includeTags:[],excludeTags:[],wildcardTags:[],includeMetatags:[],excludeMetatags:[]},s=t.split(/\s+/),a=0;a<s.length;a++)if(!e._isInvalidTag(s[a])){var i=e._getExcludeTag(s[a]);if(null===i){var r=e._getWildcardTag(s[a]);if(null===r)if(A.isMetatag(s[a])){var o=A.getMetatag(s[a]);if(null!==o){n.includeMetatags.push(o);continue}}else n.includeTags.push(s[a]);else n.wildcardTags.push(r)}else{if(A.isMetatag(i)){var l=A.getMetatag(i);if(null!==l){n.excludeMetatags.push(l);continue}continue}n.excludeTags.push(i)}}return n}}]),e}(),G=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this)).blacklist=e,s}return Object(c.a)(n,[{key:"approve",value:function(e){for(var t=0;t<this._lines.length;++t)if(n._match(e,this._lines[t]))return!1;return!0}},{key:"blacklist",set:function(e){this._lines=[];for(var t=e.split(/\n+/),n=0;n<t.length;++n){var s=U._sortTags(t[n]);0!==s.includeTags.length&&0!==s.excludeTags.length&&0!==s.wildcardTags.length&&0!==s.includeMetatags.length&&0!==s.excludeMetatags.length&&this._lines.push(s)}}}],[{key:"_match",value:function(e,t){return U._includesAllTags(e,t.includeTags)&&U._excludesAllTags(e,t.excludeTags)&&U._includesAnyTag(e,t.wildcardTags)&&U._includesAllMetatags(e,t.includeMetatags)&&U._excludesAllMetatags(e,t.excludeMetatags)}}]),n}(U),R=function(){function e(t,n){Object(l.a)(this,e),this.fetcher=t,this.posts={},this.order=[],this.pages=[],this.pageLocations={},this.currentPostIndex=null,this.currentPageIndex=null,this.blacklistFilter=new G(n),this.lookahead=!1,this.maxLookahead=2e3,this.validExtensions=new Set(["png","jpg","gif","webm"])}return Object(c.a)(e,[{key:"empty",value:function(){this.posts={},this.order=[],this.pages=[],this.pageLocations={},this.currentPostIndex=null,this.currentPageIndex=null}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._fetch(e)}},{key:"_fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};!1===this.fetcher.finished&&this.fetcher.fetch(this._fetchCallback.bind(this,e))}},{key:"_fetchIfNeeded",value:function(){null!==this.currentPostIndex&&this.currentPostIndex>=this.order.length-20&&this._fetch()}},{key:"_fetchCallback",value:function(e,t){0===t.length?e&&e(!1):(this._addPosts(t),e&&e(!0),this.lookahead&&this.order.length<this.maxLookahead&&this._fetch())}},{key:"_isPostAllowed",value:function(e){return!!this.validExtensions.has(e.fileExtension)&&!!this.blacklistFilter.approve(e)}},{key:"_addPosts",value:function(e){for(var t=[],n=this.pages.length,s=0;s<e.length;s++){var a=e[s];this._isPostAllowed(a)&&(this.posts[a.id]=a,this.order.push(a.id),t.push(a.id),this.pageLocations[a.id]=n)}this.pages.push(t)}},{key:"moveToStart",value:function(){this.currentPostIndex=0}},{key:"moveTo",value:function(e){this.currentPostIndex=e}},{key:"next",value:function(){if(null!==this.currentPostIndex){this.currentPostIndex++;var e=this.order.length;return this.currentPostIndex>=e?(this.currentPostIndex=e>0?e-1:0,!1):(this._fetchIfNeeded(),!0)}}},{key:"prev",value:function(){if(null!==this.currentPostIndex)return this.currentPostIndex--,!(this.currentPostIndex<0)||(this.currentPostIndex=0,!1)}},{key:"getPostById",value:function(e){return this.posts[e]}},{key:"getPostByIndex",value:function(e){return this.posts[this.order[e]]}},{key:"getPostsByPage",value:function(e){if(e<0||e>this.pages.length)return[];for(var t=[],n=0;n<this.pages[e].length;++n)t.push(this.posts[this.pages[e][n]]);return t}},{key:"getAllPosts",value:function(){for(var e=[],t=0;t<this.order.length;t++)e.push(this.posts[this.order[t]]);return e}},{key:"getAllPages",value:function(){for(var e=[],t=0;t<this.pages.length;++t)e.push(this.getPostsByPage(t));return e}},{key:"getCurrentPost",value:function(){return null!==this.currentPostIndex?this.getPostByIndex(this.currentPostIndex):null}},{key:"getCachePosts",value:function(e,t){var n=[];if(null!==this.currentPostIndex){var s=this.currentPostIndex-t,a=this.currentPostIndex+e;s<0&&(s=0),a>=this.order.length&&(a=this.order.length-1);for(var i=s;i<=a;i++)n.push(this.getPostByIndex(i))}return n}}]),e}(),D=(n(30),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this,e)).search=s.search.bind(Object(u.a)(s)),s.searchCallback=s.searchCallback.bind(Object(u.a)(s)),s.openSlideshow=s.openSlideshow.bind(Object(u.a)(s)),s.openGallery=s.openGallery.bind(Object(u.a)(s)),s.slideshowNext=s.slideshowNext.bind(Object(u.a)(s)),s.slideshowPrev=s.slideshowPrev.bind(Object(u.a)(s)),s.keydownHandler=s.keydownHandler.bind(Object(u.a)(s)),s.openSearch=s.openSearch.bind(Object(u.a)(s)),s.openSettings=s.openSettings.bind(Object(u.a)(s)),s.galleryViewPost=s.galleryViewPost.bind(Object(u.a)(s)),s.addToSet=s.addToSet.bind(Object(u.a)(s)),s.onSettingsChange=s.onSettingsChange.bind(Object(u.a)(s)),s.state={mode:"search",api:"e621",settings:P.initialState,currentCache:[],slideshowPost:null,posts:[],postManager:null},s}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"search"===this.state.mode?"mount show":"mount"},a.a.createElement(x,{searchCallback:this.search,escape:this.openGallery})),a.a.createElement("div",{className:"slideshow"===this.state.mode?"mount show":"mount"},a.a.createElement(J,{post:this.state.slideshowPost,next:this.slideshowNext,prev:this.slideshowPrev,escape:this.openGallery,addToSet:this.addToSet})),a.a.createElement("div",{className:"gallery"===this.state.mode?"mount show":"mount"},a.a.createElement(T,{postManager:this.state.postManager,openSearch:this.openSearch,openSettings:this.openSettings,viewPost:this.galleryViewPost})),a.a.createElement("div",{className:"settings"===this.state.mode?"mount show":"mount"},a.a.createElement(P,{close:this.openGallery,onSettingsChange:this.onSettingsChange})),a.a.createElement(I,{posts:this.state.currentCache}))}},{key:"keydownHandler",value:function(e){if("slideshow"===this.state.mode)switch(e.which||e.keyCode){case 37:case 65:return void this.slideshowPrev();case 39:case 68:return void this.slideshowNext();default:return}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keydownHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydownHandler)}},{key:"search",value:function(e){var t=new R(new _(e.tags,30),this.state.settings.userBlacklist);t.start(this.searchCallback),this.setState({mode:"gallery",postManager:t})}},{key:"update",value:function(){this.setState({posts:this.state.postManager.getAllPosts(),currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}},{key:"searchCallback",value:function(){this.update()}},{key:"openSearch",value:function(){this.setState({mode:"search"})}},{key:"openSlideshow",value:function(){this.setState({mode:"slideshow"})}},{key:"openGallery",value:function(){this.setState({mode:"gallery"})}},{key:"openSettings",value:function(){this.setState({mode:"settings"})}},{key:"slideshowNext",value:function(){this.state.postManager.next(),this.update()}},{key:"slideshowPrev",value:function(){this.state.postManager.prev(),this.update()}},{key:"galleryViewPost",value:function(e){this.state.postManager.moveTo(e),this.update(),this.setState({mode:"slideshow"})}},{key:"addToSet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.success,n=void 0===t?function(){}:t,s=e.failure,a=void 0===s?function(){}:s,i=this.state.postManager.getCurrentPost();k.addPostToSet({post_id:i.id,set_id:this.state.settings.setID,success:n,failure:a})}},{key:"onSettingsChange",value:function(e){this.setState((function(t){return{settings:Object(o.a)(Object(o.a)({},t.settings),e)}}))}}]),n}(a.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[19,1,2]]]);
//# sourceMappingURL=main.425ff65d.chunk.js.map