(this.webpackJsonpslideshow=this.webpackJsonpslideshow||[]).push([[0],[,,,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/missing.a7a5b39c.png"},,function(e,t,n){e.exports=n(28)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),i=n(13),r=n.n(i),o=(n(21),n(6)),c=n(2),l=n(1),u=n(3),h=n(5),p=n(4),d=n(8),g=n.n(d),f=n(10),m=n(11),v=n.n(m),y=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"storeLogin",value:function(e,t){window.localStorage.setItem("username",e),window.localStorage.setItem("api_key",t)}},{key:"removeLogin",value:function(){window.localStorage.removeItem("username"),window.localStorage.removeItem("api_key")}},{key:"authParameters",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e&&null!==t?{login:e,api_key:t}:{}}},{key:"authHeaders",get:function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("api_key");return null!==e||null!==t?{Authorization:"Basic "+btoa(e+":"+t)}:{}}},{key:"username",get:function(){return window.localStorage.getItem("username")}}]),e}(),b=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"_getURLAddons",value:function(){return Object(o.a)({_client:"Ilm's Slideshow/2.0"},y.authHeaders)}},{key:"getPosts",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,c,l,u,h,p,d,f,m=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=m.length>0&&void 0!==m[0]?m[0]:{},s=n.tags,a=void 0===s?"":s,i=n.page,r=void 0===i?1:i,c=n.limit,l=void 0===c?null:c,u=n.success,h=void 0===u?function(){}:u,p=n.failure,d=void 0===p?function(){}:p,f={tags:a,page:r},null!==l&&(f.limit=l),v.a.ajax({type:"GET",url:"https://e621.net/posts.json",data:Object(o.a)(Object(o.a)({},f),e._getURLAddons()),success:h,failure:d});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"addPostToSet",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,c,l,u,h,p,d=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d.length>0&&void 0!==d[0]?d[0]:{},s=n.post_id,a=void 0===s?null:s,i=n.set_id,r=void 0===i?null:i,c=n.success,l=void 0===c?function(){}:c,u=n.failure,h=void 0===u?function(){}:u,null!==a&&null!==r){t.next=4;break}return setTimeout((function(){h()}),0),t.abrupt("return");case 4:p={"post_ids[]":a},v.a.ajax({type:"POST",url:"https://e621.net/post_sets/"+r+"/add_posts.json",data:Object(o.a)(Object(o.a)({},p),e._getURLAddons()),success:l,failure:h});case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getUser",value:function(){var t=Object(f.a)(g.a.mark((function t(){var n,s,a,i,r,o,c=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:{},s=n.user,a=n.success,i=void 0===a?function(){}:a,r=n.failure,o=void 0===r?function(){}:r,s){t.next=4;break}return setTimeout((function(){o()}),0),t.abrupt("return");case 4:v.a.ajax({type:"GET",url:"https://e621.net/users/"+s+".json",data:e._getURLAddons(),success:i,failure:o});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),e}(),k=n(7),w=function(){function e(t){Object(c.a)(this,e),this.apiJson=t}return Object(l.a)(e,[{key:"_bypassURL",value:function(t){return e.bypassDefaultBlacklist?"https://static1.e621.net/data/"+t+this.md5.substring(0,2)+"/"+this.md5.substring(2,4)+"/"+this.md5+"."+(""!==t?"jpg":this.fileExtension):null}}]),Object(l.a)(e,[{key:"getAlternate",value:function(e,t){if(e=e.toLowerCase(),t=t.toLowerCase(),!this._alternatesJson.hasOwnProperty(e))return null;switch(t){case"webm":return this._alternatesJson[e].urls[0]||this.fileURL;case"mp4":return this._alternatesJson[e].urls[1]||this.fileURL;default:return null}}},{key:"getTagsInGroup",value:function(e){return this.apiJson.tags.hasOwnProperty(e)?this.apiJson.tags[e]:null}},{key:"link",get:function(){return"https://e621.net/posts/"+this.apiJson.id}},{key:"id",get:function(){return this.apiJson.id}},{key:"md5",get:function(){return this.apiJson.file.md5}},{key:"width",get:function(){return this.apiJson.file.width}},{key:"height",get:function(){return this.apiJson.file.height}},{key:"fileSize",get:function(){return this.apiJson.file.size}},{key:"fileExtension",get:function(){return this.apiJson.file.ext}},{key:"isBlocked",get:function(){return null===this.apiJson.file.url}},{key:"fileURL",get:function(){return this.apiJson.file.url||this._bypassURL("")}},{key:"previewURL",get:function(){return this.apiJson.preview.url||("swf"===this.fileExtension?"https://static1.e621.net/images/download-preview.png":this._bypassURL("preview/"))}},{key:"hasSample",get:function(){return this.apiJson.sample.has}},{key:"sampleURL",get:function(){return this.apiJson.sample.url||this._bypassURL(!0===this.hasSample?"sample/":"")}},{key:"hasAlternates",get:function(){return this.alternateSizes.length}},{key:"_alternatesJson",get:function(){return this.apiJson.sample.alternates}},{key:"alternateSizes",get:function(){return Object.keys(this._alternatesJson)}},{key:"score",get:function(){return this.apiJson.score.total}},{key:"upvotes",get:function(){return this.apiJson.score.up}},{key:"downvotes",get:function(){return this.apiJson.score.down}},{key:"rating",get:function(){return this.apiJson.rating}},{key:"tags",get:function(){return[].concat(Object(k.a)(this.tagsInGroup("artist")),Object(k.a)(this.tagsInGroup("copyright")),Object(k.a)(this.tagsInGroup("character")),Object(k.a)(this.tagsInGroup("species")),Object(k.a)(this.tagsInGroup("general")),Object(k.a)(this.tagsInGroup("meta")),Object(k.a)(this.tagsInGroup("lore")),Object(k.a)(this.tagsInGroup("invalid")))}},{key:"favCount",get:function(){return this.apiJson.fav_count}},{key:"sources",get:function(){return this.apiJson.sources}},{key:"poolIDs",get:function(){return this.apiJson.pools}},{key:"parentID",get:function(){return this.apiJson.relationships.parent_id}},{key:"hasChildren",get:function(){return this.apiJson.relationships.has_children}},{key:"hasActiveChildren",get:function(){return this.apiJson.relationships.has_active_children}},{key:"childIDs",get:function(){return this.apiJson.relationships.children}},{key:"description",get:function(){return this.apiJson.description}},{key:"commentCount",get:function(){return this.apiJson.comment_count}},{key:"favorited",get:function(){return this.apiJson.is_favorited}},{key:"duration",get:function(){return this.apiJson.duration}}]),e}();w.bypassDefaultBlacklist=!0;var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Object(c.a)(this,e),this.limit=t,this.ready=!0,this.queue=[]}return Object(l.a)(e,[{key:"add",value:function(e){this.queue.push(e),this.processQueue()}},{key:"processQueue",value:function(){this.queue.length>0&&this.ready&&(this.ready=!1,this.queue.shift()(),setTimeout(this.refresh.bind(this),this.limit))}},{key:"refresh",value:function(){this.ready=!0,this.processQueue()}}]),e}(),O=function(){function e(t){Object(c.a)(this,e),this.tags=t,this.limit=50,this._page=1,this._fetching=!1,this._finished=!1}return Object(l.a)(e,[{key:"fetch",value:function(t){if(!0===this._finished)return setTimeout((function(){t([])}),0),!0;if(!0===this._fetching)return!1;this._fetching=!0;var n={tags:this.tags,page:this._page,limit:this.limit,success:this.fetchSuccess.bind(this,t)};return e.queue.add((function(){b.getPosts(n)})),this._page++,!0}},{key:"fetchSuccess",value:function(e,t){if(this._fetching=!1,0===t.posts.length)this._finished=!0,e([]);else{for(var n=[],s=0;s<t.posts.length;++s)n.push(new w(t.posts[s]));e(n)}}},{key:"finished",get:function(){return this._finished}}]),e}();O.queue=new j(1e3);var C=n(15),E=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.label,n=Object(C.a)(e,["label"]);return a.a.createElement(a.a.Fragment,null,a.a.createElement("h2",null,t),a.a.createElement("input",n))}}]),n}(a.a.Component),S=(n(23),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).handleTagsChange=s.handleTagsChange.bind(Object(u.a)(s)),s.handleTagsKey=s.handleTagsKey.bind(Object(u.a)(s)),s.search=s.search.bind(Object(u.a)(s)),s.state={tags:""},s}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"form filter-form"},a.a.createElement(E,{label:"Tags",type:"text",onChange:this.handleTagsChange,onKeyPress:this.handleTagsKey}),a.a.createElement("button",{onClick:this.search},"Search"),a.a.createElement("button",{onClick:this.props.escape},"Close"))}},{key:"handleTagsChange",value:function(e){this.setState({tags:e.target.value})}},{key:"handleTagsKey",value:function(e){"Enter"===e.key&&(e.target.blur(),this.search())}},{key:"search",value:function(){var e={tags:this.state.tags};this.props.searchCallback(e)}}]),n}(a.a.Component)),x=n(9),I=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).handleLocalChange=s.handleLocalChange.bind(Object(u.a)(s)),s.handleChange=s.handleChange.bind(Object(u.a)(s)),s.handleSaveLogin=s.handleSaveLogin.bind(Object(u.a)(s)),s.fetchBlacklist=s.fetchBlacklist.bind(Object(u.a)(s)),s.state={username:"",apiKey:"",userBlacklist:"",avoidAnonBlacklist:!1,setID:""},s}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"form settings-form"},a.a.createElement("button",{onClick:this.props.close},"Close Settings"),a.a.createElement(E,{label:"Username",type:"text",name:"username",value:this.state.username,onChange:this.handleLocalChange}),a.a.createElement(E,{label:"API Key",type:"password",name:"apiKey",value:this.state.apiKey,onChange:this.handleLocalChange}),a.a.createElement("button",{id:"e621-save-login-button",onClick:this.handleSaveLogin},"Store Login Locally"),a.a.createElement(E,{label:"Avoid Anon Blacklist",type:"checkbox",name:"avoidAnonBlacklist",checked:this.state.avoidAnonBlacklist,onChange:this.handleChange}),a.a.createElement("h2",null,"Blacklist"),a.a.createElement("button",{id:"fetch-user-blacklist-button",onClick:this.fetchBlacklist},"Get blacklist"),a.a.createElement("textarea",{name:"userBlacklist",value:this.state.userBlacklist,onChange:this.handleChange}),a.a.createElement(E,{label:"Set ID",type:"text",name:"setID",value:this.state.setID,onChange:this.handleChange}),a.a.createElement("button",{onClick:this.props.close},"Close Settings"))}},{key:"handleLocalChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(x.a)({},t.name,n))}},{key:"handleChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value;this.setState(Object(x.a)({},t.name,n)),this.props.onSettingsChange(Object(x.a)({},t.name,n))}},{key:"handleSaveLogin",value:function(){y.storeLogin(this.state.username,this.state.apiKey),this.setState({username:"",apiKey:""})}},{key:"fetchBlacklist",value:function(){var e=this._setBlacklist.bind(this),t=y.username;b.getUser({user:t,success:function(n){n.hasOwnProperty("blacklist")?e(n.blacklist):e("(error_not_logged_in:"+t+")")},failure:function(){e("(error_invalid_user:"+t+")")}})}},{key:"_setBlacklist",value:function(e){this.setState({userBlacklist:e})}}]),n}(a.a.Component),P=(n(24),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e="card";return e+=" content-type-"+this.props.post.fileExtension,a.a.createElement("div",{className:e},a.a.createElement("button",{onClick:this.props.callback},a.a.createElement("img",{src:this.props.post.previewURL,alt:""})))}}]),n}(a.a.Component)),_=(n(25),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"gallery"},a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.openSearch},"Search"),a.a.createElement("button",{onClick:this.props.openSettings},"Settings")),a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),a.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")),a.a.createElement("div",{className:"gallery-content"},this.getCards()),a.a.createElement("div",{className:"gallery-controls"},a.a.createElement("button",{onClick:this.props.prevPage,disabled:!this.props.prevPage},"Prev Page"),a.a.createElement("button",{onClick:this.props.nextPage,disabled:!this.props.nextPage},"Next Page")))}},{key:"getCards",value:function(){var e=this,t=[];if(this.props.postManager)for(var n=this.props.postManager.getAllPosts(),s=function(s){t.push(a.a.createElement(P,{key:n[s].id,post:n[s],callback:function(){e.props.viewPost(s)}}))},i=0;i<n.length;i++)s(i);return t}}]),n}(a.a.Component)),J=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{style:{display:"none"}},this.getImages(this.props.posts))}},{key:"getImages",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(a.a.createElement("img",{key:e[n].id,alt:"",src:"webm"===e[n].fileExtension?e[n].sampleURL:e[n].fileURL}));return t}}]),n}(a.a.Component),L=(n(26),n(14)),N=n.n(L),T=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e="slide-wrapper";return this.props.post&&(e+=" content-type-"+this.props.post.fileExtension),a.a.createElement("div",{className:e},a.a.createElement("div",{className:"slide"},this.getSlideContents()),a.a.createElement("div",{className:"slide-controls"},a.a.createElement("button",{className:"prev-button",onClick:this.props.prev},"Previous"),a.a.createElement("button",{className:"escape-button",onClick:this.props.escape},"Close"),a.a.createElement("a",{className:"source-button",href:this.props.post?this.props.post.link:null,target:"_blank",rel:"noopener noreferrer"},"Link"),a.a.createElement("button",{className:"next-button",onClick:this.props.next},"Next")))}},{key:"getSlideContents",value:function(){if(this.props.post)switch(this.props.post.fileExtension){case"jpg":case"png":case"gif":return a.a.createElement("img",{className:"current-image",key:this.props.post.id,src:this.props.post.fileURL,alt:""});case"webm":return this.getVideoElement()}return a.a.createElement("img",{className:"current-image",src:N.a,alt:""})}},{key:"getVideoElement",value:function(){return a.a.createElement("video",{className:"current-video",key:this.props.post.id,width:this.props.post.width,height:this.props.post.height,poster:this.props.post.sampleURL,controls:!0},a.a.createElement("source",{src:this.props.post.getAlternate("original","webm"),type:"video/webm"}),a.a.createElement("source",{src:this.props.post.getAlternate("original","mp4"),type:"video/mp4"}),"Your browser does not support the video tag, or cannot handle webm or mp4 files.")}}]),n}(a.a.Component),B=function(){function e(t){Object(c.a)(this,e),this.fetcher=t,this.posts={},this.order=[],this.currentIndex=null,this.validExtensions=new Set(["png","jpg","gif","webm"])}return Object(l.a)(e,[{key:"empty",value:function(){this.posts={},this.order=[],this.currentIndex=null}},{key:"fetchIfApplicable",value:function(e){!1===this.fetcher.finished&&(null===this.currentIndex||this.order.length-this.currentIndex<20)&&this.fetcher.fetch(this.fetchCallback.bind(this,e))}},{key:"fetchCallback",value:function(e,t){0===t.length?e&&e(!1):(this.addPosts(t),e&&e(!0))}},{key:"isPostAllowed",value:function(e){return this.validExtensions.has(e.fileExtension)}},{key:"addPosts",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.isPostAllowed(n)&&(this.posts[n.id]=n,this.order.push(n.id))}}},{key:"moveToStart",value:function(){this.currentIndex=0}},{key:"moveTo",value:function(e){this.currentIndex=e}},{key:"next",value:function(){if(null!==this.currentIndex){this.currentIndex++;var e=this.order.length;return this.currentIndex>=e?(this.currentIndex=e>0?e-1:0,!1):(this.fetchIfApplicable(),!0)}}},{key:"prev",value:function(){if(null!==this.currentIndex)return this.currentIndex--,!(this.currentIndex<0)||(this.currentIndex=0,!1)}},{key:"getPostById",value:function(e){return this.posts[e]}},{key:"getPostByIndex",value:function(e){return this.posts[this.order[e]]}},{key:"getAllPosts",value:function(){for(var e=[],t=0;t<this.order.length;t++)e.push(this.posts[this.order[t]]);return e}},{key:"getCurrentPost",value:function(){return null!==this.currentIndex?this.getPostByIndex(this.currentIndex):null}},{key:"getCachePosts",value:function(e,t){var n=[];if(null!==this.currentIndex){var s=this.currentIndex-t,a=this.currentIndex+e;s<0&&(s=0),a>=this.order.length&&(a=this.order.length-1);for(var i=s;i<=a;i++)n.push(this.getPostByIndex(i))}return n}}]),e}(),A=(n(27),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).search=s.search.bind(Object(u.a)(s)),s.searchCallback=s.searchCallback.bind(Object(u.a)(s)),s.openSlideshow=s.openSlideshow.bind(Object(u.a)(s)),s.openGallery=s.openGallery.bind(Object(u.a)(s)),s.slideshowNext=s.slideshowNext.bind(Object(u.a)(s)),s.slideshowPrev=s.slideshowPrev.bind(Object(u.a)(s)),s.keydownHandler=s.keydownHandler.bind(Object(u.a)(s)),s.openSearch=s.openSearch.bind(Object(u.a)(s)),s.openSettings=s.openSettings.bind(Object(u.a)(s)),s.galleryViewPost=s.galleryViewPost.bind(Object(u.a)(s)),s.addToSet=s.addToSet.bind(Object(u.a)(s)),s.onSettingsChange=s.onSettingsChange.bind(Object(u.a)(s)),s.state={mode:"search",api:"e621",settings:{},currentCache:[],slideshowPost:null,posts:[],postManager:null},s}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"search"===this.state.mode?"mount show":"mount"},a.a.createElement(S,{searchCallback:this.search,escape:this.openGallery})),a.a.createElement("div",{className:"slideshow"===this.state.mode?"mount show":"mount"},a.a.createElement(T,{post:this.state.slideshowPost,next:this.slideshowNext,prev:this.slideshowPrev,escape:this.openGallery,addToSet:this.addToSet})),a.a.createElement("div",{className:"gallery"===this.state.mode?"mount show":"mount"},a.a.createElement(_,{postManager:this.state.postManager,openSearch:this.openSearch,openSettings:this.openSettings,viewPost:this.galleryViewPost})),a.a.createElement("div",{className:"settings"===this.state.mode?"mount show":"mount"},a.a.createElement(I,{close:this.openGallery,onSettingsChange:this.onSettingsChange})),a.a.createElement(J,{posts:this.state.currentCache}))}},{key:"keydownHandler",value:function(e){if("slideshow"===this.state.mode)switch(e.which||e.keyCode){case 37:case 65:return void this.slideshowPrev();case 39:case 68:return void this.slideshowNext();default:return}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keydownHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keydownHandler)}},{key:"search",value:function(e){var t=new B(new O(e.tags,60));t.fetchIfApplicable(this.searchCallback),this.setState({mode:"gallery",postManager:t})}},{key:"update",value:function(){this.setState({posts:this.state.postManager.getAllPosts(),currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}},{key:"searchCallback",value:function(){this.update()}},{key:"openSearch",value:function(){this.setState({mode:"search"})}},{key:"openSlideshow",value:function(){this.setState({mode:"slideshow"})}},{key:"openGallery",value:function(){this.setState({mode:"gallery"})}},{key:"openSettings",value:function(){this.setState({mode:"settings"})}},{key:"slideshowNext",value:function(){this.state.postManager.next(),this.update()}},{key:"slideshowPrev",value:function(){this.state.postManager.prev(),this.update()}},{key:"galleryViewPost",value:function(e){this.state.postManager.moveTo(e),this.update(),this.setState({mode:"slideshow"})}},{key:"addToSet",value:function(){var e=this.state.postManager.getCurrentPost();b.addPostToSet({post_id:e.id,set_id:this.settings.setID})}},{key:"onSettingsChange",value:function(e){this.setState((function(t){return{settings:Object(o.a)(Object(o.a)({},t.settings),e)}}))}}]),n}(a.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[16,1,2]]]);
//# sourceMappingURL=main.8f31fa25.chunk.js.map