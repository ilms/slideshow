{"version":3,"sources":["missing.png","helpers/Authentication.js","api/E621API.js","api/Post.js","helpers/ThrottleQueue.js","api/E621Searcher.js","components/Field.js","components/E621Filters.js","components/E621Settings.js","components/Card.js","components/Gallery.js","components/ImageCache.js","components/Slideshow.js","api/metatags/Metatag.js","api/filters/Filter.js","api/filters/BlacklistFilter.js","helpers/PostManager.js","components/App.js","serviceWorker.js","index.js"],"names":["module","exports","Authentication","username","apiKey","window","localStorage","setItem","removeItem","getItem","login","api_key","btoa","E621API","_client","authParameters","tags","page","limit","success","failure","params","$","ajax","type","url","data","_getURLAddons","post_id","set_id","setTimeout","error","user","Post","apiJson","this","bypassDefaultBlacklist","md5","substring","fileExtension","size","extension","toLowerCase","_alternatesJson","hasOwnProperty","fileURL","group","_bypassURL","hasSample","alternateSizes","length","Object","keys","getTagsInGroup","ThrottleQueue","ready","queue","fn","push","processQueue","shift","refresh","bind","E621Searcher","_page","_fetching","_finished","callback","request","_fetchSuccess","add","getPosts","posts","i","Field","props","label","other","React","Component","E621Filters","handleTagsChange","handleTagsKey","search","state","className","onChange","onKeyPress","onClick","escape","e","setState","target","value","key","blur","filters","searchCallback","E621Settings","handleLocalChange","handleChange","handleSaveLogin","fetchBlacklist","initialState","fetchSets","close","name","id","checked","avoidAnonBlacklist","userBlacklist","_getSetSelection","event","onSettingsChange","storeLogin","setBlacklist","_setBlacklist","getUser","json","getSets","sets","_defaultSets","setID","_getSetSelectionGroup","options","_getSetSelectionOption","Owned","Maintained","Card","post","src","previewURL","alt","Gallery","openSearch","openSettings","prevPage","disabled","nextPage","getCards","cards","postManager","getAllPosts","viewPost","ImageCache","style","display","getImages","images","sampleURL","Slideshow","removeSetText","addSetText","removeFromSet","addToSet","wrapperClassName","getSlideContents","prev","href","link","rel","next","onNewPost","prevProps","getVideoElement","missing","width","height","poster","controls","getAlternate","Metatag","metatagClass","_metatagClasses","metatag","includes","split","tag","METATAGS","startsWith","Filter","_includesTag","metatags","matches","test","sorted","includeTags","excludeTags","wildcardTags","includeMetatags","excludeMetatags","tagList","_isInvalidTag","excludeTag","_getExcludeTag","wildcardTag","_getWildcardTag","isMetatag","getMetatag","excludeMetatag","BlacklistFilter","blacklist","_lines","_match","blacklistLines","sortedTags","_sortTags","_includesAllTags","_excludesAllTags","_includesAnyTag","_includesAllMetatags","_excludesAllMetatags","PostManager","fetcher","order","pages","pageLocations","currentPostIndex","currentPageIndex","blacklistFilter","lookahead","maxLookahead","validExtensions","Set","_fetch","finished","fetch","_fetchCallback","_addPosts","has","approve","pageIndex","_isPostAllowed","index","postCount","_fetchIfNeeded","allPosts","getPostByIndex","preload","postload","minimum","maximum","App","openSlideshow","openGallery","slideshowNext","slideshowPrev","keydownHandler","galleryViewPost","mode","api","settings","currentCache","slideshowPost","which","keyCode","document","addEventListener","removeEventListener","start","getCachePosts","getCurrentPost","update","moveTo","addPostToSet","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","then","registration","unregister","catch","console","message"],"mappings":"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","file":"static/js/main.d8232e32.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/missing.a7a5b39c.png\";","/**\r\n * This class handles all methods for storing and reading e621\r\n * login credentials for the API\r\n */\r\nclass Authentication {\r\n  /**\r\n   * Stores the login credentials for a user.\r\n   * \r\n   * @param {string} username - The user's username\r\n   * \r\n   * @param {string} apiKey - One of the user's API keys\r\n   */\r\n  static storeLogin(username, apiKey) {\r\n    window.localStorage.setItem('username', username);\r\n    window.localStorage.setItem('api_key', apiKey);\r\n  }\r\n\r\n  /**\r\n   * Removes the currently stored user credentials.\r\n   */\r\n  static removeLogin() {\r\n    window.localStorage.removeItem('username');\r\n    window.localStorage.removeItem('api_key');\r\n  }\r\n\r\n  /**\r\n   * Gets the credentials for authenticating via URL parameters.\r\n   * This method of authentication is not recommended.\r\n   * \r\n   * @returns {AuthParams|Object} \r\n   *          The URL parameters or an empty object if not logged in\r\n   */\r\n  static get authParameters() {\r\n    var username = window.localStorage.getItem('username');\r\n    var apiKey = window.localStorage.getItem('api_key');\r\n    if (username !== null && apiKey !== null) {\r\n      return {login: username, api_key: apiKey};\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the request headers for authenticating via HTTP Basic Auth.\r\n   * \r\n   * @returns {AuthHeaders|Object}\r\n   *          The headers or an empty object if not logged in\r\n   */\r\n  static get authHeaders() {\r\n    var username = window.localStorage.getItem('username');\r\n    var apiKey = window.localStorage.getItem('api_key');\r\n    if (username !== null || apiKey !== null) {\r\n      return {'Authorization': 'Basic ' + btoa(username + ':' + apiKey)};\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the current users username, or null if not logged in.\r\n   * \r\n   * @returns {string|null} The username\r\n   */\r\n  static get username() {\r\n    return window.localStorage.getItem('username');\r\n  }\r\n}\r\n\r\nexport default Authentication;\r\n\r\n/**\r\n * @typedef {Object} AuthParams\r\n * @property {string} login - The user's username\r\n * @property {string} api_key - One of the user's API keys\r\n */\r\n\r\n/**\r\n * @typedef {Object} AuthHeaders\r\n * @property {string} Authorization - The HTTP basic auth credentials\r\n */\r\n","import $ from 'jquery';\r\n\r\nimport Authentication from '../helpers/Authentication';\r\n\r\n\r\nconst USER_AGENT = \"Ilm's Slideshow/2.0\";\r\n\r\n/**\r\n * This class contains methods for interfacing directly with the e621 API.\r\n */\r\nexport default class E621API {\r\n  /**\r\n   * Returns URL parameters that should be present with every request.\r\n   * This includes the user agent and login credentials.\r\n   * \r\n   * @returns {Object.<string, string>} URL parameters\r\n   */\r\n  static _getURLAddons() {\r\n    // TODO switch to HTTP Basic Auth when possible\r\n    return {\r\n      _client: USER_AGENT,\r\n      ...Authentication.authParameters,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets a list of posts. Equivalent to an e621 search.\r\n   * \r\n   * @param {Object} request - The parameters of the request\r\n   * \r\n   * @param {string} request.tags\r\n   *        Follows conventions of the e621 search box\r\n   * \r\n   * @param {number|string} request.page\r\n   *        Page number, or 'b'+post_id or 'a'+post_id for posts\r\n   *        before or after a specific post\r\n   * \r\n   * @param {number|null} request.limit \r\n   *        Number of posts per page (API has hard limit of 320)\r\n   *        or null for user's default (or 75 if not logged in)\r\n   * \r\n   * @param {successCallback} request.success\r\n   *        Callback function to handle successful requests.\r\n   * \r\n   * @param {callback} request.failure\r\n   *        Callback function to handle failed requests.\r\n   */\r\n  static async getPosts({\r\n      tags='', \r\n      page=1, \r\n      limit=null, \r\n      success=()=>{}, \r\n      failure=()=>{},\r\n  }={}) {\r\n    let params = {\r\n      tags: tags,\r\n      page: page,\r\n    };\r\n    if (limit !== null) {\r\n      params['limit'] = limit;\r\n    }\r\n    $.ajax({\r\n      type: 'GET',\r\n      url: 'https://e621.net/posts.json',\r\n      data: {\r\n        ...params,\r\n        ...E621API._getURLAddons(),\r\n      },\r\n      success: success,\r\n      failure: failure,\r\n    });\r\n  }\r\n\r\n  static async addPostToSet({\r\n    post_id=null,\r\n    set_id=null,\r\n    success=()=>{}, \r\n    failure=()=>{},\r\n  }={}) {\r\n    if (post_id === null || set_id === null || set_id === '') {\r\n      setTimeout(() => { failure(); }, 0);\r\n      return;\r\n    }\r\n    let params = {\r\n      'post_ids[]': post_id,\r\n    };\r\n    // TODO add better error handling, i.e. message of issue\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: 'https://e621.net/post_sets/' + set_id + '/add_posts.json',\r\n      data: {\r\n        ...params,\r\n        ...E621API._getURLAddons(),\r\n      },\r\n      success: success,\r\n      failure: failure,\r\n      error: failure,\r\n    });\r\n  }\r\n\r\n  static async getUser({\r\n    user,\r\n    success=()=>{}, \r\n    failure=()=>{},\r\n  }={}) {\r\n    if (!user) {\r\n      setTimeout(() => { failure(); }, 0);\r\n      return;\r\n    }\r\n    $.ajax({\r\n      type: 'GET',\r\n      url: 'https://e621.net/users/' + user + '.json',\r\n      data: E621API._getURLAddons(),\r\n      success: success,\r\n      failure: failure,\r\n    });\r\n  }\r\n\r\n  // TODO write documention - gets sets available to user (owned + managed)\r\n  static async getSets({\r\n    success=()=>{}, \r\n    failure=()=>{},\r\n  }={}) {\r\n    $.ajax({\r\n      type: 'GET',\r\n      url: 'https://e621.net/post_sets/for_select.json',\r\n      data: E621API._getURLAddons(),\r\n      success: success,\r\n      failure: failure,\r\n      error: failure,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Callback function for successful API calls.\r\n * @callback successCallback\r\n * @param {Object} data - The JSON response from the API call\r\n */\r\n","/**\r\n * A wrapper class for posts from the e621 API.\r\n */\r\nexport default class Post {\r\n  /**\r\n   * When true, contentURL, previewURL, and sampleURL will ignore\r\n   * e621's anon blacklist and return their proper URLs.\r\n   */\r\n  static bypassDefaultBlacklist = true;\r\n\r\n  /**\r\n   * Returns the URL for a resource if bypassDefaultBlacklist is true. \r\n   * \r\n   * @param {string} type\r\n   *        '' for file, 'preview/' for preview, 'sample/' for sample\r\n   * \r\n   * @returns {string|null} \r\n   *          The resource URL, or null if bypassDefaultBlacklist is false\r\n   */\r\n  _bypassURL(type) {\r\n    if (!Post.bypassDefaultBlacklist) return null;\r\n    let f1 = this.md5.substring(0, 2);\r\n    let f2 = this.md5.substring(2, 4);\r\n    return 'https://static1.e621.net/data/' + type + f1 + '/' + f2 + \r\n            '/' + this.md5 +'.' + (type !== '' ? 'jpg' : this.fileExtension);\r\n  }\r\n\r\n  /**\r\n   * Creates a Post object from a JSON API result.\r\n   * \r\n   * @param {JSON} post - A single post from the API\r\n   */\r\n  constructor(apiJson) {\r\n    this.apiJson = apiJson;\r\n  }\r\n\r\n  /**\r\n   * The URL linking to the post on e621.net.\r\n   * \r\n   * @type {string} \r\n   */\r\n  get link() {\r\n    return 'https://e621.net/posts/' + this.apiJson['id'];\r\n  }\r\n\r\n  /**\r\n   * The id of the post.\r\n   * \r\n   * @type {number} \r\n   */\r\n  get id() {\r\n    return this.apiJson['id'];\r\n  }\r\n\r\n  /**\r\n   * The MD5 of the file.\r\n   * \r\n   * @type {string}\r\n   */\r\n  get md5() {\r\n    return this.apiJson['file']['md5'];\r\n  }\r\n\r\n  /**\r\n   * The width of the full size file.\r\n   * \r\n   * @type {number}\r\n   */\r\n  get width() {\r\n    return this.apiJson['file']['width'];\r\n  }\r\n\r\n  /**\r\n   * The height of the full size file.\r\n   * \r\n   * @type {number}\r\n   */\r\n  get height() {\r\n    return this.apiJson['file']['height'];\r\n  }\r\n\r\n  /**\r\n   * The size of the original file in bytes.\r\n   * \r\n   * @type {number}\r\n   */\r\n  get fileSize() {\r\n    return this.apiJson['file']['size'];\r\n  }\r\n\r\n  /**\r\n   * The file extension for the full image, video, or flash file.\r\n   * \r\n   * @type {string} \r\n   */\r\n  get fileExtension() {\r\n    return this.apiJson['file']['ext'];\r\n  }\r\n\r\n  /**\r\n   * True when the post is blocked by the anon blacklist.\r\n   * \r\n   * @type {boolean}\r\n   */\r\n  get isBlocked() {\r\n    return this.apiJson['file']['url'] === null;\r\n  }\r\n\r\n  /**\r\n   * The URL for the post's file (full image, original video, or flash file),\r\n   * or null when the post is blocked by the anon blacklist.\r\n   * \r\n   * @type {string|null} \r\n   */\r\n  get fileURL() {\r\n    return this.apiJson['file']['url'] || this._bypassURL('');\r\n  }\r\n\r\n  /**\r\n   * The URL for the post's preview image,\r\n   * or null when the post is blocked by the anon blacklist.\r\n   * \r\n   * All preivews are limited to 150px for width and height.\r\n   * \r\n   * Images have a scaled preview of their original image.\r\n   * Videos have a scaled preview of the first frame.\r\n   * Flash files have a square white image that says 'Flash'.\r\n   * \r\n   * @type {string|null} \r\n   */\r\n  get previewURL() {\r\n    return this.apiJson['preview']['url'] || \r\n            (this.fileExtension === 'swf' ? \r\n              'https://static1.e621.net/images/download-preview.png' : \r\n              this._bypassURL('preview/'));\r\n  }\r\n\r\n  /**\r\n   * True when the post has a sample.\r\n   * \r\n   * @type {boolean} \r\n   */\r\n  get hasSample() {\r\n    return this.apiJson['sample']['has'];\r\n  }\r\n\r\n  /**\r\n   * The URL for the post's sample image,\r\n   * or null when the post is blocked by the anon blacklist.\r\n   * \r\n   * Posts that dont have a sample will return the original file.\r\n   * \r\n   * Images:\r\n   * - Have a preview when full image width excedes 850px.\r\n   * - Preview image is scaled to 850px width.\r\n   * \r\n   * Videos:\r\n   * - Always have previews\r\n   * - Preview image is full scale of first frame.\r\n   * \r\n   * Flash:\r\n   * - Never have previews\r\n   * \r\n   * @type {string|null} \r\n   */\r\n  get sampleURL() {\r\n    return this.apiJson['sample']['url'] || \r\n            this._bypassURL(this.hasSample === true ? 'sample/' : '');\r\n  }\r\n\r\n  /**\r\n   * True when the post has alternate files.\r\n   * \r\n   * @return {boolean}\r\n   */\r\n  get hasAlternates() {\r\n    return this.alternateSizes.length;\r\n  }\r\n\r\n  /**\r\n   * The alternates part of the JSON.\r\n   * \r\n   * @returns {JSON}\r\n   */\r\n  get _alternatesJson() {\r\n    return this.apiJson['sample']['alternates'];\r\n  }\r\n\r\n  /**\r\n   * Array of available alternate file sizes.\r\n   * \r\n   * For videos, the options are:\r\n   * - 'original': The original resolution\r\n   * - '480p': 480p if the original is larger\r\n   * - '720p': 720p if the original is larger\r\n   * \r\n   * @returns {Array.<string>}\r\n   */\r\n  get alternateSizes() {\r\n    return Object.keys(this._alternatesJson);\r\n  }\r\n\r\n  /**\r\n   * Returns the URL for the alternate of the specified size and file type.\r\n   * \r\n   * @param {string} size\r\n   *        The size of the alternate.\r\n   *        \r\n   *        For videos this should be:\r\n   *        - 'original': The original resolution\r\n   *        - '480p': 480p if the original is larger\r\n   *        - '720p': 720p if the original is larger\r\n   * \r\n   * @param {string} extension \r\n   *        The file extension of the alternate \r\n   * \r\n   * @returns {string|null} \r\n   *          The URL to the alternate, or null if not found.\r\n   */\r\n  getAlternate(size, extension) {\r\n    size = size.toLowerCase();\r\n    extension = extension.toLowerCase();\r\n    if (!this._alternatesJson.hasOwnProperty(size)) {\r\n      return null;\r\n    }\r\n    switch (extension) {\r\n      case 'webm':\r\n        return this._alternatesJson[size]['urls'][0] || this.fileURL;\r\n      case 'mp4':\r\n        return this._alternatesJson[size]['urls'][1] || this.fileURL;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The post's score.\r\n   * \r\n   * @returns {number} The score\r\n   */\r\n  get score() {\r\n    return this.apiJson['score']['total'];\r\n  }\r\n\r\n  /**\r\n   * The number of upvotes on the post.\r\n   * \r\n   * @returns {number} The number of upvotes\r\n   */\r\n  get upvotes() {\r\n    return this.apiJson['score']['up'];\r\n  }\r\n\r\n  /**\r\n   * The number of downvotes on the post.\r\n   * \r\n   * @returns {number} The number of downvotes\r\n   */\r\n  get downvotes() {\r\n    return this.apiJson['score']['down'];\r\n  }\r\n\r\n  /**\r\n   * The rating of the post.\r\n   *  - 's': safe\r\n   *  - 'q': questionable\r\n   *  - 'e': explicit\r\n   * \r\n   * @returns {string} A letter representing the rating\r\n   */\r\n  get rating() {\r\n    return this.apiJson['rating'];\r\n  }\r\n\r\n  /**\r\n   * Array of tags on the post.\r\n   * \r\n   * The order of these tags will match those listed on e621.net,\r\n   * with the exception of invalid tags which are moved to the end.\r\n   * \r\n   * @returns {Array.<string>}\r\n   */\r\n  get tags() {\r\n    return [\r\n      ...this.getTagsInGroup('artist'),\r\n      ...this.getTagsInGroup('copyright'),\r\n      ...this.getTagsInGroup('character'),\r\n      ...this.getTagsInGroup('species'),\r\n      ...this.getTagsInGroup('general'),\r\n      ...this.getTagsInGroup('meta'),\r\n      ...this.getTagsInGroup('lore'),\r\n      ...this.getTagsInGroup('invalid'),\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Returns array of tags in a specific group, or null for invalid groups.\r\n   * \r\n   * Groups names are dependent on the API.\r\n   * \r\n   * Current Groups:\r\n   * - artist\r\n   * - copyright\r\n   * - character\r\n   * - species\r\n   * - general\r\n   * - meta\r\n   * - lore\r\n   * - invalid\r\n   * \r\n   * @returns {Array.<string>|null}\r\n   */\r\n  getTagsInGroup(group) {\r\n    if (!this.apiJson['tags'].hasOwnProperty(group)) {\r\n      return null;\r\n    }\r\n    return this.apiJson['tags'][group];\r\n  }\r\n\r\n  /**\r\n   * The number of favorites for the post.\r\n   * \r\n   * @returns {number} The number of favorites\r\n   */\r\n  get favCount() {\r\n    return this.apiJson['fav_count']; \r\n  }\r\n\r\n  /**\r\n   * The sources of the post.\r\n   * \r\n   * @returns {Array.<string>} Array of URLs\r\n   */\r\n  get sources() {\r\n    return this.apiJson['sources'];\r\n  }\r\n\r\n  /**\r\n   * Array of pool IDs that contain this post.\r\n   * \r\n   * @returns {Array.<number>} Array of pool IDs\r\n   */\r\n  get poolIDs() {\r\n    return this.apiJson['pools'];\r\n  }\r\n\r\n  /**\r\n   * The ID of the parent post, or null if no parent.\r\n   * \r\n   * @returns {number|null} The parent post ID\r\n   */\r\n  get parentID() {\r\n    return this.apiJson['relationships']['parent_id'];\r\n  }\r\n\r\n  /**\r\n   * True when the post has children (including deleted child posts).\r\n   * \r\n   * @returns {boolean} Whether or not the post has children\r\n   */\r\n  get hasChildren() {\r\n    return this.apiJson['relationships']['has_children'];\r\n  }\r\n\r\n  /**\r\n   * True when the post has non-deleted children.\r\n   * \r\n   * @returns {boolean} Whether or not the post has children\r\n   */\r\n  get hasActiveChildren() {\r\n    return this.apiJson['relationships']['has_active_children'];\r\n  }\r\n\r\n  /**\r\n   * Array of child post IDs.\r\n   * \r\n   * @returns {Array.<number>} Array of child post IDs\r\n   */\r\n  get childIDs() {\r\n    return this.apiJson['relationships']['children'];\r\n  }\r\n\r\n  /**\r\n   * Returns the description of the post.\r\n   * \r\n   * @returns {string} The post description\r\n   */\r\n  get description() {\r\n    return this.apiJson['description']\r\n  }\r\n\r\n  /**\r\n   * The number of comments on the post.\r\n   * \r\n   * @returns {number} Number of comments\r\n   */\r\n  get commentCount() {\r\n    return this.apiJson['comment_count'];\r\n  }\r\n\r\n  /**\r\n   * True when the current user has favorited the post.\r\n   * \r\n   * @returns {boolean} Whether or not the post is favorited\r\n   */\r\n  get favorited() {\r\n    return this.apiJson['is_favorited'];\r\n  }\r\n\r\n  /**\r\n   * Duration of the video in seconds, or null for non-videos.\r\n   * \r\n   * @returns {number|null} Duration of video in seconds\r\n   */\r\n  get duration() {\r\n    return this.apiJson['duration'];\r\n  }\r\n}\r\n","// Allows functions to be called at a throttled rate\r\nexport class ThrottleQueue {\r\n  constructor (limit = 1000) {\r\n    this.limit = limit;\r\n    this.ready = true;\r\n    this.queue = [];\r\n  }\r\n\r\n  // Adds a function to the queue\r\n  add(fn) {\r\n    this.queue.push(fn);\r\n    this.processQueue();\r\n  }\r\n\r\n  // Calls the oldest function from the queue, if one exists \r\n  processQueue() {\r\n    if (this.queue.length > 0 && this.ready) {\r\n      this.ready = false;\r\n      this.queue.shift()();\r\n      setTimeout(this.refresh.bind(this), this.limit);\r\n    }\r\n  }\r\n\r\n  // Called when the cooldown finishes, processes next function\r\n  refresh() {\r\n    this.ready = true;\r\n    this.processQueue();\r\n  }\r\n}\r\n\r\nexport default ThrottleQueue;\r\n","import E621API from './E621API';\r\nimport Post from './Post';\r\nimport ThrottleQueue from '../helpers/ThrottleQueue';\r\n\r\n\r\n/**\r\n * This class \r\n */\r\nexport default class E621Searcher {\r\n  static queue = new ThrottleQueue(1000);\r\n\r\n  constructor(tags) {\r\n    this.tags = tags;\r\n    this.limit = 100;\r\n    this._page = 1;\r\n    this._fetching = false;\r\n    this._finished = false;\r\n  }\r\n\r\n  fetch(callback) {\r\n    if (this._finished === true) {\r\n      setTimeout(() => { callback([]); }, 0);\r\n      return true;\r\n    } else if (this._fetching === true) {\r\n      return false;\r\n    } else {\r\n      this._fetching = true;\r\n      let request = {\r\n        tags: this.tags,\r\n        page: this._page,\r\n        limit: this.limit,\r\n        success: this._fetchSuccess.bind(this, callback),\r\n      }\r\n      E621Searcher.queue.add(function() {\r\n        E621API.getPosts(request);\r\n      });\r\n      this._page++;\r\n      return true;\r\n    }\r\n  }\r\n\r\n  _fetchSuccess(callback, data) {\r\n    this._fetching = false;\r\n    if (data['posts'].length === 0) {\r\n      this._finished = true;\r\n      callback([]);\r\n    } else {\r\n      let posts = [];\r\n      for (let i = 0; i < data['posts'].length; ++i) {\r\n        posts.push(new Post(data['posts'][i]));\r\n      }\r\n      callback(posts);\r\n    }\r\n  }\r\n\r\n  get finished() {\r\n    return this._finished;\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\n\r\nclass Field extends React.Component {\r\n  render() {\r\n    let {label, ...other} = this.props;\r\n    return (\r\n      <>\r\n        <h2>{label}</h2>\r\n        <input {...other} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Field;\r\n","import React from 'react';\r\n\r\nimport Field from './Field';\r\n\r\nimport './E621Filters.css';\r\n\r\n\r\nclass E621Filters extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.handleTagsChange = this.handleTagsChange.bind(this);\r\n    this.handleTagsKey = this.handleTagsKey.bind(this);\r\n    this.search = this.search.bind(this);\r\n    // TODO fix fields not filling with old data\r\n    this.state = {tags: ''};\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"form filter-form\">\r\n        <Field label=\"Tags\" type=\"text\" \r\n               onChange={this.handleTagsChange} \r\n               onKeyPress={this.handleTagsKey} />\r\n        <button onClick={this.search}>\r\n          Search\r\n        </button>\r\n        <button onClick={this.props.escape}>\r\n          Close\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  handleTagsChange(e) {\r\n    this.setState({ tags: e.target.value });\r\n  }\r\n\r\n  handleTagsKey(e) {\r\n    if (e.key === 'Enter') {\r\n      e.target.blur();\r\n      this.search();\r\n    }\r\n  }\r\n\r\n  search() {\r\n    let filters = {\r\n      tags: this.state.tags\r\n    };\r\n    this.props.searchCallback(filters);\r\n  }\r\n}\r\n\r\nexport default E621Filters;\r\n","import React from 'react';\r\nimport Authentication from '../helpers/Authentication';\r\n\r\nimport E621API from '../api/E621API';\r\nimport Field from './Field';\r\n\r\n\r\nclass E621Settings extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.handleLocalChange = this.handleLocalChange.bind(this);\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSaveLogin = this.handleSaveLogin.bind(this);\r\n    this.fetchBlacklist = this.fetchBlacklist.bind(this);\r\n    this.state = E621Settings.initialState;\r\n    this.fetchBlacklist();\r\n    this.fetchSets();\r\n  }\r\n\r\n  static get initialState() {\r\n    return {\r\n      username: '',\r\n      apiKey: '',\r\n      userBlacklist: '',\r\n      avoidAnonBlacklist: false,\r\n      setID: '',\r\n      sets: E621Settings._defaultSets(),\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"form settings-form\">\r\n        <button onClick={this.props.close}>\r\n          Close Settings\r\n        </button>\r\n        <Field label=\"Username\" type=\"text\" \r\n               name=\"username\" value={this.state.username}\r\n               onChange={this.handleLocalChange} />\r\n        <Field label=\"API Key\" type=\"password\" \r\n               name=\"apiKey\" value={this.state.apiKey}\r\n               onChange={this.handleLocalChange} />\r\n        <button id=\"e621-save-login-button\" onClick={this.handleSaveLogin}>\r\n          Store Login Locally\r\n        </button>\r\n        <Field label=\"Avoid Anon Blacklist\" type=\"checkbox\" \r\n               name=\"avoidAnonBlacklist\" checked={this.state.avoidAnonBlacklist}\r\n               onChange={this.handleChange} />\r\n        <h2>Blacklist</h2>\r\n        <button id=\"fetch-user-blacklist-button\" onClick={this.fetchBlacklist}>\r\n          Get blacklist\r\n        </button>\r\n        <textarea name=\"userBlacklist\" value={this.state.userBlacklist}\r\n               onChange={this.handleChange} />\r\n        <h2>Selected Set</h2>\r\n        {this._getSetSelection()}\r\n        <button onClick={this.props.close}>\r\n          Close Settings\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  handleLocalChange(event) {\r\n    let target = event.target;\r\n    let value = target.type === 'checkbox' ? target.checked : target.value;\r\n    this.setState({[target.name]: value});\r\n  }\r\n\r\n  handleChange(event) {\r\n    let target = event.target;\r\n    let value = target.type === 'checkbox' ? target.checked : target.value;\r\n    this.setState({[target.name]: value});\r\n    this.props.onSettingsChange({[target.name]: value});\r\n  }\r\n\r\n  handleSaveLogin() {\r\n    Authentication.storeLogin(this.state.username, this.state.apiKey);\r\n    this.setState({ username: '', apiKey: '' });\r\n    this.fetchBlacklist();\r\n    this.fetchSets();\r\n  }\r\n\r\n  fetchBlacklist() {\r\n    let setBlacklist = this._setBlacklist.bind(this);\r\n    let username = Authentication.username;\r\n    E621API.getUser({\r\n      user: username,\r\n      success: (json) => {\r\n        if (json.hasOwnProperty('blacklisted_tags')) {\r\n          setBlacklist(json['blacklisted_tags']);\r\n        } else {\r\n          setBlacklist('(error_not_logged_in:' + username + ')');\r\n        }\r\n      },\r\n      failure: () => {\r\n        setBlacklist('(error_invalid_user:' + username + ')');\r\n      },\r\n    });\r\n  }\r\n\r\n  _setBlacklist(value) {\r\n    this.setState({userBlacklist: value});\r\n    this.props.onSettingsChange({userBlacklist: value});\r\n  }\r\n\r\n  fetchSets() {\r\n    let setState = this.setState.bind(this);\r\n    E621API.getSets({\r\n      success: (json) => { setState({sets: json}); },\r\n      failure: () => { setState({sets: E621Settings._defaultSets()}); },\r\n    });\r\n  }\r\n\r\n  static _defaultSets() {\r\n    return {Owned: [], Maintained: []};\r\n  }\r\n\r\n  _getSetSelection() {\r\n    return (\r\n      <select name=\"setID\" value={this.state.setID}\r\n              onChange={this.handleChange}>\r\n        <optgroup label=\"Owned\">\r\n          {this._getSetSelectionGroup(this.state.sets['Owned'])}\r\n        </optgroup>\r\n        <optgroup label=\"Maintained\">\r\n          {this._getSetSelectionGroup(this.state.sets['Maintained'])}\r\n        </optgroup>\r\n      </select>\r\n    );\r\n  }\r\n\r\n  _getSetSelectionGroup(group) {\r\n    let options = [];\r\n    for (let i = 0; i < group.length; ++i) {\r\n      options.push(this._getSetSelectionOption(group[i][0], group[i][1]));\r\n    }\r\n    return options;\r\n  }\r\n\r\n  _getSetSelectionOption(name, id) {\r\n    return <option value={id} key={id}>{name}</option>;\r\n  }\r\n}\r\n\r\nexport default E621Settings;\r\n","import React from 'react';\r\n\r\nimport './Card.css';\r\n\r\n\r\nclass Card extends React.Component {\r\n  render() {\r\n    let className = 'card';\r\n    className += ' content-type-' + this.props.post.fileExtension;\r\n    return (\r\n      <div className={className}>\r\n        <button onClick={this.props.callback}>\r\n          <img src={this.props.post.previewURL} alt=\"\" />\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Card;\r\n","import React from 'react';\r\n\r\nimport Card from './Card';\r\n\r\nimport './Gallery.css';\r\n\r\n\r\nclass Gallery extends React.Component {\r\n  render() {\r\n    return (\r\n      <div className=\"gallery\">\r\n        <div className=\"gallery-controls\">\r\n          <button onClick={this.props.openSearch}>Search</button>\r\n          <button onClick={this.props.openSettings}>Settings</button>\r\n        </div>\r\n        <div className=\"gallery-controls\">\r\n          <button onClick={this.props.prevPage} disabled={!this.props.prevPage}>Prev Page</button>\r\n          <button onClick={this.props.nextPage} disabled={!this.props.nextPage}>Next Page</button>\r\n        </div>\r\n        <div className=\"gallery-content\">\r\n          {this.getCards()}\r\n        </div>\r\n        <div className=\"gallery-controls\">\r\n          <button onClick={this.props.prevPage} disabled={!this.props.prevPage}>Prev Page</button>\r\n          <button onClick={this.props.nextPage} disabled={!this.props.nextPage}>Next Page</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getCards() {\r\n    let cards = [];\r\n    if (this.props.postManager) {\r\n      let posts = this.props.postManager.getAllPosts();\r\n      for (let i = 0; i < posts.length; i++) {\r\n        cards.push(\r\n          <Card key={posts[i].id}\r\n                post={posts[i]} \r\n                callback={() => {this.props.viewPost(i)}} />\r\n        );\r\n      }\r\n    }\r\n    return cards;\r\n  }\r\n}\r\n\r\nexport default Gallery\r\n","import React from 'react';\r\n\r\n\r\nexport class ImageCache extends React.Component {\r\n  render() {\r\n    return (\r\n      <div style={{display: \"none\"}}>\r\n        {this.getImages(this.props.posts)}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getImages(posts) {\r\n    let images = [];\r\n    for (let i = 0; i < posts.length; i++) {\r\n      images.push(<img key={posts[i].id} alt=\"\"\r\n        src={posts[i].fileExtension === 'webm' ? \r\n              posts[i].sampleURL : posts[i].fileURL}/>)\r\n    }\r\n    return images;\r\n  }\r\n}\r\n\r\nexport default ImageCache;\r\n","import React from 'react';\r\n\r\nimport './Slideshow.css';\r\nimport missing from '../missing.png';\r\n\r\n\r\nexport class Slideshow extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      removeSetText: '',\r\n      addSetText: '',\r\n    }\r\n    this.removeFromSet = this.removeFromSet.bind(this);\r\n    this.addToSet = this.addToSet.bind(this);\r\n  }\r\n\r\n  render() {\r\n    let wrapperClassName = 'slide-wrapper';\r\n    if (this.props.post) {\r\n      wrapperClassName += ' content-type-' + this.props.post.fileExtension;\r\n    }\r\n    return (\r\n      <div className={wrapperClassName}>\r\n        <div className=\"slide\">\r\n          {this.getSlideContents()}\r\n        </div>\r\n        <div className=\"slide-controls\">\r\n          <button className=\"prev-button\" onClick={this.props.prev}>Previous</button>\r\n          <button className=\"escape-button\" onClick={this.props.escape}>Close</button>\r\n          <a className=\"source-button\" href={this.props.post ? this.props.post.link : null} \r\n             target=\"_blank\" rel=\"noopener noreferrer\">Link</a>\r\n          <button className=\"next-button\" onClick={this.props.next}>Next</button>\r\n        </div>\r\n        <div className=\"slide-controls-extra\">\r\n          <button className=\"add-set-button\" onClick={this.addToSet}>\r\n            {this.state.addSetText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.onNewPost();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.post !== this.props.post) {\r\n      this.onNewPost();\r\n    }\r\n  }\r\n\r\n  onNewPost() {\r\n    this.setState({\r\n      removeSetText: '',\r\n      addSetText: '',\r\n    });\r\n  }\r\n\r\n  removeFromSet() {\r\n    // TODO\r\n  }\r\n\r\n  addToSet() {\r\n    let setState = this.setState.bind(this);\r\n    setState({addSetText: ''});\r\n    this.props.addToSet({\r\n      success: () => { setState({addSetText: ''}); }, \r\n      failure: () => { setState({addSetText: ''}); }, \r\n    });\r\n  }\r\n\r\n  getSlideContents() {\r\n    if (this.props.post) {\r\n      switch(this.props.post.fileExtension) {\r\n        case 'jpg':\r\n        case 'png':\r\n        case 'gif':\r\n          return <img className=\"current-image\" key={this.props.post.id}\r\n                      src={this.props.post.fileURL} alt=\"\" />;\r\n        case 'webm':\r\n          return this.getVideoElement();\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    return <img className=\"current-image\" src={missing} alt=\"\" />;\r\n  }\r\n\r\n  getVideoElement() {\r\n    return (\r\n      <video className=\"current-video\" key={this.props.post.id}\r\n             width={this.props.post.width}\r\n             height={this.props.post.height} \r\n             poster={this.props.post.sampleURL} controls>\r\n        <source src={this.props.post.getAlternate('original', 'webm')} \r\n                type=\"video/webm\" />\r\n        <source src={this.props.post.getAlternate('original', 'mp4')} \r\n                type=\"video/mp4\" />\r\n        Your browser does not support the video tag, \r\n        or cannot handle webm or mp4 files.\r\n      </video>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Slideshow;\r\n","import Post from '../Post';\r\n\r\n\r\n/**\r\n * Base class for e621 metatags.\r\n */\r\nexport default class Metatag {\r\n  static _metatagClasses = {};\r\n\r\n  /**\r\n   * Verifies that the metatag matches for the post.\r\n   * \r\n   * @param {Post} post The post\r\n   * \r\n   * @returns {boolean} A match of the metatag\r\n   */\r\n  matches(post) {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * The metatag's text name on e621\r\n   */\r\n  static get name() {\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Returns the string form of the metatag.\r\n   * \r\n   * @returns {string} The metatag as a string\r\n   */\r\n  toString() {\r\n    return '';\r\n  }\r\n\r\n  static _registerMetatagClass(metatagClass) {\r\n    Metatag._metatagClasses[metatagClass.name] = metatagClass; \r\n  }\r\n\r\n  /**\r\n   * Returns a metatag from its text form, or null if invalid.\r\n   * \r\n   * @param {string} metatag The metatag in text form\r\n   */\r\n  static getMetatag(metatag) {\r\n    if (!metatag.includes(':')) return null;\r\n    let [name,value] = metatag.split(':', 1);\r\n    if (Metatag._metatagClasses.hasOwnProperty(name)) {\r\n      return new Metatag._metatagClasses[name](value);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns true when the tag is a metatag\r\n   * \r\n   * @param {string} tag \r\n   * \r\n   * @return {boolean}\r\n   */\r\n  static isMetatag(tag) {\r\n    for (let i = 0; i < METATAGS.length; ++i) {\r\n      if (tag.startsWith(METATAGS[i] + ':')) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nconst METATAGS = [\r\n  // User-Based\r\n  'user',\r\n  'favoritedby',\r\n  'voted',\r\n  'votedup',\r\n  'voteddown',\r\n  'approvedby',\r\n  'deletedby',\r\n  // Post-Based\r\n  // Counts\r\n  'id',\r\n  'score',\r\n  'favcount',\r\n  'comment_count',\r\n  'tagcount',\r\n  'gentags',\r\n  'arttags',\r\n  'chartags',\r\n  'copytags',\r\n  'spectags',\r\n  'invtags',\r\n  // Image Size\r\n  'width',\r\n  'height',\r\n  'mpixels',\r\n  'ratio',\r\n  'filesize',\r\n  // Video Duration\r\n  'duration',\r\n  // Dates\r\n  'date',\r\n  // Rating\r\n  'rating',\r\n  // File Types\r\n  'type',\r\n  // Text Searching\r\n  'source',\r\n  'description',\r\n  'notes',\r\n  'delreason',\r\n  // Parents and Children\r\n  'ischild',\r\n  'isparent',\r\n  'parent',\r\n  // Status\r\n  'status',\r\n  // Other\r\n  'hassource',\r\n  'hasdescription',\r\n  'ratinglocked',\r\n  'notelocked',\r\n  'hideanon',\r\n  'hidegoogle',\r\n  'inpool',\r\n  'pool',\r\n  'set',\r\n  'md5',\r\n  // Sorting\r\n  'order',\r\n];\r\n","import Metatag from '../metatags/Metatag';\r\nimport Post from '../Post';\r\n\r\n\r\n/**\r\n * Filters are classes that approve or reject posts, \r\n * such as a blacklist or list of search tags.\r\n */\r\nexport default class Filter {\r\n  /**\r\n   * Approves a post when matching a certain criteria.\r\n   * \r\n   * @param {Post} post The post to approve\r\n   * \r\n   * @returns {boolean} Whether or not the post is approved\r\n   */\r\n  approve(post) {\r\n    return true;\r\n  }\r\n\r\n  static _includesTag(post, tag) {\r\n    return post.tags.includes(tag);\r\n  }\r\n\r\n  static _includesAllTags(post, tags) {\r\n    for (let i = 0; i < tags.length; ++i) {\r\n      if (!this._includesTag(post, tags[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  static _excludesAllTags(post, tags) {\r\n    for (let i = 0; i < tags.length; ++i) {\r\n      if (this._includesTag(post, tags[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  static _includesAnyTag(post, tags) {\r\n    if (tags.length === 0) return true;\r\n    for (let i = 0; i < tags.length; ++i) {\r\n      if (this._includesTag(post, tags[i])) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static _includesAllMetatags(post, metatags) {\r\n    for (let i = 0; i < metatags.length; ++i) {\r\n      if (!metatags[i].matches(post)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  static _excludesAllMetatags(post, metatags) {\r\n    for (let i = 0; i < metatags.length; ++i) {\r\n      if (metatags[i].matches(post)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  static _getExcludeTag(tag) {\r\n    if (tag.startsWith('-') && tag.length > 1) {\r\n      return tag.substring(1);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  static _getWildcardTag(tag) {\r\n    if (tag.startsWith('~') && tag.length > 1) {\r\n      return tag.substring(1);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  static _isInvalidTag(tag) {\r\n    if (tag === '') return true;\r\n    if (tag === '-') return true;\r\n    if (tag === '~') return true;\r\n    if (/[%,#\\\\* ]/.test(tag)) return true;\r\n    return false;\r\n  }\r\n\r\n  static _sortTags(tags) {\r\n    let sorted = {\r\n      includeTags: [],\r\n      excludeTags: [],\r\n      wildcardTags: [],\r\n      includeMetatags: [],\r\n      excludeMetatags: [],\r\n    }\r\n    let tagList = tags.split(/\\s+/);\r\n    for (let i = 0; i < tagList.length; i++) {\r\n      if (Filter._isInvalidTag(tagList[i])) continue;\r\n      let excludeTag = Filter._getExcludeTag(tagList[i]);\r\n      if (excludeTag !== null) {\r\n        if (Metatag.isMetatag(excludeTag)) {\r\n          let excludeMetatag = Metatag.getMetatag(excludeTag);\r\n          if (excludeMetatag !== null) {\r\n            sorted['excludeMetatags'].push(excludeMetatag);\r\n            continue;\r\n          } else {\r\n            // ignore invalid/unimplemented metatags\r\n            continue;\r\n          }\r\n        } else {\r\n          sorted['excludeTags'].push(excludeTag);\r\n          continue;\r\n        }\r\n      }\r\n      let wildcardTag = Filter._getWildcardTag(tagList[i]);\r\n      if (wildcardTag !== null) {\r\n        sorted['wildcardTags'].push(wildcardTag);\r\n        continue;\r\n      }\r\n      if (Metatag.isMetatag(tagList[i])) {\r\n        let metatag = Metatag.getMetatag(tagList[i]);\r\n        if (metatag !== null) {\r\n          sorted['includeMetatags'].push(metatag);\r\n          continue;\r\n        } else {\r\n          // ignore invalid/unimplemented metatags\r\n          continue;\r\n        }\r\n      }\r\n      sorted['includeTags'].push(tagList[i]);\r\n    }\r\n    return sorted;\r\n  }\r\n}\r\n","import Filter from './Filter';\r\nimport Post from '../../api/Post';\r\n\r\n\r\n/**\r\n * Filter that verifies that posts pass a blacklist.\r\n */\r\nexport default class BlacklistFilter extends Filter {\r\n  /**\r\n   * Creates a new BlacklistFilter for a blacklist\r\n   * \r\n   * @param {string} blacklist Blacklist as formatted in user setting\r\n   */\r\n  constructor(blacklist) {\r\n    super();\r\n    this.blacklist = blacklist;\r\n  }\r\n\r\n  // /**\r\n  //  * The current blacklist\r\n  //  */\r\n  // get blacklist() {\r\n  //   return this._blacklist;\r\n  // }\r\n\r\n  /**\r\n   * The current blacklist\r\n   */\r\n  set blacklist(blacklist) {\r\n    // TODO change to linewise additions\r\n    this._lines = [];\r\n    let blacklistLines = blacklist.split(/\\n+/);\r\n    for (let i = 0; i < blacklistLines.length; ++i) {\r\n      let sortedTags = Filter._sortTags(blacklistLines[i]);\r\n      if (sortedTags['includeTags'].length !== 0\r\n          && sortedTags['excludeTags'].length !== 0\r\n          && sortedTags['wildcardTags'].length !== 0\r\n          && sortedTags['includeMetatags'].length !== 0\r\n          && sortedTags['excludeMetatags'].length !== 0) {\r\n        this._lines.push(sortedTags);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true when the post is allowed by the blacklist\r\n   * \r\n   * @param {Post} post - The post to approve\r\n   * \r\n   * @returns {boolean} True when the post is allowed by the blacklist\r\n   */\r\n  approve(post) {\r\n    for (let i = 0; i < this._lines.length; ++i) {\r\n      if (BlacklistFilter._match(post, this._lines[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  static _match(post, sortedTags) {\r\n    return Filter._includesAllTags(post, sortedTags['includeTags']) &&\r\n            Filter._excludesAllTags(post, sortedTags['excludeTags']) &&\r\n            Filter._includesAnyTag(post, sortedTags['wildcardTags']) &&\r\n            Filter._includesAllMetatags(post, sortedTags['includeMetatags']) &&\r\n            Filter._excludesAllMetatags(post, sortedTags['excludeMetatags']);\r\n  }\r\n}\r\n","import BlacklistFilter from '../api/filters/BlacklistFilter';\r\n\r\n\r\nexport class PostManager {\r\n  constructor(fetcher, blacklist) {\r\n    this.fetcher = fetcher;\r\n    this.posts = {};\r\n    this.order = [];\r\n    this.pages = [];\r\n    this.pageLocations = {};\r\n    this.currentPostIndex = null;\r\n    this.currentPageIndex = null;\r\n    this.blacklistFilter = new BlacklistFilter(blacklist);\r\n    this.lookahead = false; // PostManager will automatically get pages\r\n    this.maxLookahead = 2000; // Max posts grabbed automatically before stopping\r\n    // TODO manage extensions per platform\r\n    // e621Extensions = new Set(['png','jpg','gif'])\r\n    // faExtensions = new Set(['png','jpg','jpeg','gif','bmp'])\r\n    this.validExtensions = new Set(['png','jpg','gif','webm']);\r\n  }\r\n\r\n  empty() {\r\n    this.posts = {};\r\n    this.order = [];\r\n    this.pages = [];\r\n    this.pageLocations = {};\r\n    this.currentPostIndex = null;\r\n    this.currentPageIndex = null;\r\n  }\r\n\r\n  /**\r\n   * Starts searching for posts.\r\n   * \r\n   * @param {CallableFunction} callback \r\n   *               Called with true when posts were found, false otherwise.\r\n   *               This can return true while no posts are present if they \r\n   *               are all blacklisted or flash files. \r\n   */\r\n  start(callback = () => {}) {\r\n    this._fetch(callback);\r\n  }\r\n\r\n  /**\r\n   * Fetches the next page of posts\r\n   * \r\n   * @param {CallableFunction} callback \r\n   *               Called with true when posts were found, false otherwise.\r\n   *               This can return true while no posts are present if they \r\n   *               are all blacklisted or flash files. \r\n   */\r\n  _fetch(callback = () => {}) {\r\n    if (this.fetcher.finished === false) {\r\n      this.fetcher.fetch(this._fetchCallback.bind(this, callback));\r\n    }\r\n  }\r\n\r\n  _fetchIfNeeded() {\r\n    if (this.currentPostIndex === null) return;\r\n    if (this.currentPostIndex >= this.order.length - 20) {\r\n      // || this.currentPageIndex >= this.pages.length - 1) {\r\n      this._fetch();\r\n    }\r\n  }\r\n\r\n  _fetchCallback(callback, posts) {\r\n    if (posts.length === 0) {\r\n      if (callback) {\r\n        callback(false);\r\n      }\r\n    } else {\r\n      this._addPosts(posts);\r\n      if (callback) {\r\n        callback(true);\r\n      }\r\n      if (this.lookahead) {\r\n        if (this.order.length < this.maxLookahead) {\r\n          this._fetch();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  _isPostAllowed(post) {\r\n    if (!this.validExtensions.has(post.fileExtension)) return false;\r\n    if (!this.blacklistFilter.approve(post)) return false;\r\n    return true;\r\n  }\r\n\r\n  _addPosts(posts) {\r\n    let page = [];\r\n    let pageIndex = this.pages.length;\r\n    for (let i = 0; i < posts.length; i++) {\r\n      let post = posts[i];\r\n      if (this._isPostAllowed(post)) {\r\n        this.posts[post.id] = post;\r\n        this.order.push(post.id);\r\n        page.push(post.id);\r\n        this.pageLocations[post.id] = pageIndex;\r\n      }\r\n    }\r\n    this.pages.push(page);\r\n  }\r\n\r\n  moveToStart() {\r\n    this.currentPostIndex = 0;\r\n  }\r\n\r\n  moveTo(index) {\r\n    this.currentPostIndex = index;\r\n  }\r\n\r\n  next() {\r\n    if (this.currentPostIndex !== null) {\r\n      this.currentPostIndex++;\r\n      var postCount = this.order.length\r\n      if (this.currentPostIndex >= postCount){\r\n        if (postCount > 0) {\r\n          this.currentPostIndex = postCount - 1;\r\n        } else {\r\n          this.currentPostIndex = 0;\r\n        }\r\n        return false;\r\n      }\r\n      this._fetchIfNeeded();\r\n      return true;\r\n    }\r\n  }\r\n\r\n  prev() {\r\n    if (this.currentPostIndex !== null) {\r\n      this.currentPostIndex--;\r\n      if (this.currentPostIndex < 0){\r\n        this.currentPostIndex = 0;\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getPostById(id) {\r\n    return this.posts[id];\r\n  }\r\n\r\n  getPostByIndex(index) {\r\n    return this.posts[this.order[index]];\r\n  }\r\n\r\n  getAllPosts() {\r\n    let allPosts = [];\r\n    for (let i = 0; i < this.order.length; i++) {\r\n      allPosts.push(this.posts[this.order[i]]);\r\n    }\r\n    return allPosts;\r\n  }\r\n\r\n  getCurrentPost() {\r\n    return this.currentPostIndex !== null ? this.getPostByIndex(this.currentPostIndex) : null;\r\n  }\r\n\r\n  getCachePosts(preload, postload) {\r\n    let posts = [];\r\n    if (this.currentPostIndex !== null) {\r\n      let minimum = this.currentPostIndex - postload;\r\n      let maximum = this.currentPostIndex + preload;\r\n      if (minimum < 0) {\r\n          minimum = 0;\r\n      }\r\n      if (maximum >= this.order.length) {\r\n          maximum = this.order.length - 1;\r\n      }\r\n      for (let i = minimum; i <= maximum; i++) {\r\n          posts.push(this.getPostByIndex(i));\r\n      }\r\n    }\r\n    return posts;\r\n  }\r\n}\r\n\r\nexport default PostManager;\r\n","import React from 'react';\n\nimport E621API from '../api/E621API';\nimport E621Searcher from '../api/E621Searcher';\nimport E621Filters from './E621Filters';\nimport E621Settings from './E621Settings';\nimport Gallery from './Gallery';\nimport ImageCache from './ImageCache';\nimport Slideshow from './Slideshow';\nimport PostManager from '../helpers/PostManager';\n\nimport './App.css';\n\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.search = this.search.bind(this);\n    this.searchCallback = this.searchCallback.bind(this);\n    this.openSlideshow = this.openSlideshow.bind(this);\n    this.openGallery = this.openGallery.bind(this);\n    this.slideshowNext = this.slideshowNext.bind(this);\n    this.slideshowPrev = this.slideshowPrev.bind(this);\n    this.keydownHandler = this.keydownHandler.bind(this);\n    this.openSearch = this.openSearch.bind(this);\n    this.openSettings = this.openSettings.bind(this);\n    this.galleryViewPost = this.galleryViewPost.bind(this);\n    this.addToSet = this.addToSet.bind(this);\n    this.onSettingsChange = this.onSettingsChange.bind(this);\n    this.state = {\n      mode: 'search',\n      api: 'e621',\n      settings: E621Settings.initialState,\n      currentCache: [],\n      slideshowPost: null,\n      posts: [],\n      postManager: null,\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <div className={this.state.mode === 'search' ? 'mount show' : 'mount'}>\n          <E621Filters searchCallback={this.search} \n                       escape={this.openGallery} />\n        </div>\n        <div className={this.state.mode === 'slideshow' ? 'mount show' : 'mount'}>\n          <Slideshow post={this.state.slideshowPost}\n                     next={this.slideshowNext}\n                     prev={this.slideshowPrev}\n                     escape={this.openGallery}\n                     addToSet={this.addToSet} />\n        </div>\n        <div className={this.state.mode === 'gallery' ? 'mount show' : 'mount'}>\n          <Gallery postManager={this.state.postManager}\n                   openSearch={this.openSearch}\n                   openSettings={this.openSettings}\n                   viewPost={this.galleryViewPost} />\n        </div>\n        <div className={this.state.mode === 'settings' ? 'mount show' : 'mount'}>\n          <E621Settings close={this.openGallery} \n                        onSettingsChange={this.onSettingsChange} />\n        </div>\n        <ImageCache posts={this.state.currentCache} />\n      </>\n    );\n  }\n\n  keydownHandler(e) {\n    if (this.state.mode === 'slideshow') {\n      var key = e.which || e.keyCode;\n      \n      switch (key) {\n        case 37: // Left arrow\n        case 65: // A\n          this.slideshowPrev();\n          return;\n        case 39: // Right arrow\n        case 68: // D\n          this.slideshowNext();\n          return;\n        default: return;\n      }\n    }\n  }\n  \n  componentDidMount() { \n    document.addEventListener('keydown', this.keydownHandler);\n  }\n\n  componentWillUnmount() { \n    document.removeEventListener('keydown', this.keydownHandler);\n  }\n\n  search(filters) {\n    // TODO pass proper settings\n    let settings = {limit: 30};\n    let postManager = new PostManager(\n      new E621Searcher(filters.tags, settings.limit),\n      this.state.settings.userBlacklist,\n    );\n    postManager.start(this.searchCallback);\n    this.setState({\n      mode: 'gallery',\n      postManager: postManager,\n    });\n  }\n\n  update() {\n    // TODO configure cache size with settings\n    this.setState({\n      posts: this.state.postManager.getAllPosts(),\n      currentCache: this.state.postManager.getCachePosts(10, 5),\n      slideshowPost: this.state.postManager.getCurrentPost(),\n    });\n  }\n\n  searchCallback() {\n    this.update();\n  }\n\n  openSearch() {\n    this.setState({\n      mode: 'search',\n    })\n  }\n\n  openSlideshow() {\n    this.setState({\n      mode: 'slideshow',\n    });\n  }\n\n  openGallery() {\n    this.setState({\n      mode: 'gallery',\n    });\n  }\n\n  openSettings() {\n    this.setState({\n      mode: 'settings',\n    });\n  }\n\n  slideshowNext() {\n    this.state.postManager.next();\n    this.update();\n  }\n\n  slideshowPrev() {\n    this.state.postManager.prev();\n    this.update();\n  }\n\n  galleryViewPost(index) {\n    this.state.postManager.moveTo(index);\n    this.update();\n    this.setState({\n      mode: 'slideshow',\n    });\n  }\n\n  addToSet({\n    success=()=>{}, \n    failure=()=>{},\n  }={}) {\n    let post = this.state.postManager.getCurrentPost();\n    E621API.addPostToSet({\n      post_id: post.id,\n      set_id: this.state.settings.setID,\n      success: success,\n      failure: failure,\n    });\n  }\n\n  onSettingsChange(settings) {\n    this.setState((state) => {\n      return {settings: {...state.settings, ...settings}};\n    });\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}