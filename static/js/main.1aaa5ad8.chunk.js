(this.webpackJsonpslideshow=this.webpackJsonpslideshow||[]).push([[0],[,,,,,,function(e,t,s){e.exports=s.p+"static/media/missing.a7a5b39c.png"},,,,function(e,t,s){e.exports=s(18)},,,,,function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t);var n=s(0),a=s.n(n),i=s(8),r=s.n(i),c=(s(15),s(1)),o=s(2),h=s(3),l=s(5),u=s(4),d=s(9),p=s.n(d),f=function e(t,s,n,a,i){Object(c.a)(this,e),this.id=t,this.contentURL=s,this.previewURL=n,this.extension=a,this.link=i},g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Object(c.a)(this,e),this.limit=t,this.ready=!0,this.queue=[]}return Object(o.a)(e,[{key:"add",value:function(e){this.queue.push(e),this.processQueue()}},{key:"processQueue",value:function(){this.queue.length>0&&this.ready&&(this.ready=!1,this.queue.shift()(),setTimeout(this.refresh.bind(this),this.limit))}},{key:"refresh",value:function(){this.ready=!0,this.processQueue()}}]),e}(),v=function(){function e(t,s){Object(c.a)(this,e),this.filters=t,this.settings=s,this.page=1,this.fetching=!1,this.finished=!1}return Object(o.a)(e,[{key:"getURL",value:function(){return"https://e621.net/posts.json?"+new URLSearchParams({_client:e.userAgent,tags:this.filters.tags,limit:this.settings.limit,page:this.page}).toString()}},{key:"fetch",value:function(t){if(!1===this.finished&&!1===this.fetching){this.fetching=!0;var s=this.getURL(),n=this.fetchCallback.bind(this,t);e.queue.add((function(){p.a.ajax({url:s,crossDomain:!0,dataType:"json",success:n})})),this.currentPage++}}},{key:"fetchCallback",value:function(e,t){(this.fetching=!1,0===t.posts.length)?(this.finished=0,e([])):e(this.getPosts(t.posts))}},{key:"getPosts",value:function(e){for(var t=[],s=0;s<e.length;s++){var n=e[s].id,a=e[s].file.url,i=e[s].preview.url,r=e[s].file.ext,c="https://e621.net/posts/"+n;null!==a&&t.push(new f(n,a,i,r,c))}return t}}]),e}();v.userAgent="Ilm's Slideshow/1.0",v.queue=new g(1e3);var m=v,b=function(e){Object(l.a)(s,e);var t=Object(u.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(o.a)(s,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("h2",null,this.props.label),a.a.createElement("input",this.props))}}]),s}(a.a.Component),k=(s(16),function(e){Object(l.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(c.a)(this,s),(n=t.call(this,e)).handleTagsChange=n.handleTagsChange.bind(Object(h.a)(n)),n.search=n.search.bind(Object(h.a)(n)),n.state={tags:""},n}return Object(o.a)(s,[{key:"render",value:function(){return a.a.createElement("div",{className:"form"},a.a.createElement(b,{label:"Tags",type:"text",onChange:this.handleTagsChange,onKeyPress:this.handleTagsKey}),a.a.createElement("button",{onClick:this.search},"Search"),a.a.createElement("button",{onClick:this.props.escape},"Close"))}},{key:"handleTagsChange",value:function(e){this.setState({tags:e.target.value})}},{key:"handleTagsKey",value:function(e){"Enter"===e.key&&this.search()}},{key:"search",value:function(){var e={tags:this.state.tags};this.props.searchCallback(e)}}]),s}(a.a.Component)),y=function(e){Object(l.a)(s,e);var t=Object(u.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(o.a)(s,[{key:"render",value:function(){return a.a.createElement("div",{style:{display:"none"}},this.getImages(this.props.posts))}},{key:"getImages",value:function(e){for(var t=[],s=0;s<e.length;s++)t.push(a.a.createElement("img",{src:e[s].contentURL,alt:""}));return t}}]),s}(a.a.Component),w=(s(17),function(e){Object(l.a)(s,e);var t=Object(u.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(o.a)(s,[{key:"render",value:function(){return a.a.createElement("div",{className:"slide-wrapper"},a.a.createElement("div",{className:"slide"},a.a.createElement("img",{className:"current-image",src:this.props.post.contentURL,alt:""})),a.a.createElement("div",{className:"slide-controls"},a.a.createElement("button",{className:"prev-button",onClick:this.props.prev},"Previous"),a.a.createElement("button",{className:"escape-button",onClick:this.props.escape},"Close"),a.a.createElement("a",{className:"source-button",href:this.props.post.link,target:"_blank",rel:"noopener noreferrer"},"Link"),a.a.createElement("button",{className:"next-button",onClick:this.props.next},"Next")))}}]),s}(a.a.Component)),C=function(){function e(t){Object(c.a)(this,e),this.fetcher=t,this.posts={},this.order=[],this.currentIndex=0,this.validExtensions=new Set(["png","jpg","jpeg","gif","bmp"])}return Object(o.a)(e,[{key:"empty",value:function(){this.posts={},this.order=[],this.currentIndex=0}},{key:"fetchIfApplicable",value:function(e){!1===this.fetcher.finished&&this.order.length-this.currentIndex<20&&this.fetcher.fetch(this.fetchCallback.bind(this,e))}},{key:"fetchCallback",value:function(e,t){0===t.length?e&&e(!1):(this.addPosts(t),e&&e(!0))}},{key:"isPostAllowed",value:function(e){return this.validExtensions.has(e.extension)}},{key:"addPosts",value:function(e){for(var t=0;t<e.length;t++){var s=e[t];this.isPostAllowed(s)&&(this.posts[s.id]=s,this.order.push(s.id))}}},{key:"moveToStart",value:function(){this.currentIndex=0}},{key:"moveTo",value:function(e){this.currentIndex=e}},{key:"next",value:function(){this.currentIndex++;var e=this.order.length;return this.currentIndex>=e?(this.currentIndex=e>0?e-1:0,!1):(this.fetchIfApplicable(),!0)}},{key:"prev",value:function(){return this.currentIndex--,!(this.currentIndex<0)||(this.currentIndex=0,!1)}},{key:"getPostById",value:function(e){return this.posts[e]}},{key:"getPostByIndex",value:function(e){return this.posts[this.order[e]]}},{key:"getCurrentPost",value:function(){return this.getPostByIndex(this.currentIndex)}},{key:"getCachePosts",value:function(e,t){var s=this.currentIndex-t,n=this.currentIndex+e;s<0&&(s=0),n>=this.order.length&&(n=this.order.length-1);for(var a=[],i=s;i<=n;i++)a.push(this.getPostByIndex(i));return a}}]),e}(),j=s(6),E=s.n(j),x=function(e){Object(l.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(c.a)(this,s),(n=t.call(this,e)).search=n.search.bind(Object(h.a)(n)),n.searchCallback=n.searchCallback.bind(Object(h.a)(n)),n.searchEscape=n.searchEscape.bind(Object(h.a)(n)),n.slideshowEscape=n.slideshowEscape.bind(Object(h.a)(n)),n.slideshowNext=n.slideshowNext.bind(Object(h.a)(n)),n.slideshowPrev=n.slideshowPrev.bind(Object(h.a)(n)),n.keydownHandler=n.keydownHandler.bind(Object(h.a)(n)),n.state={mode:"search",api:"e621",settings:{},currentCache:[],slideshowPost:null,postManager:null},n}return Object(o.a)(s,[{key:"render",value:function(){switch(this.state.mode){default:case"search":switch(this.state.api){default:case"e621":return a.a.createElement(a.a.Fragment,null,a.a.createElement(y,{posts:this.state.currentCache}),a.a.createElement(k,{searchCallback:this.search,escape:this.searchEscape}))}case"slideshow":return a.a.createElement(a.a.Fragment,null,a.a.createElement(y,{posts:this.state.currentCache}),a.a.createElement(w,{post:this.state.slideshowPost||s.missingPost,next:this.slideshowNext,prev:this.slideshowPrev,escape:this.slideshowEscape}))}}},{key:"keydownHandler",value:function(e){if("slideshow"===this.state.mode)switch(e.which||e.keyCode){case 37:case 65:return void this.slideshowPrev();case 39:case 68:return void this.slideshowNext();default:return}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keydownHandler)}},{key:"componentWillUnmount",value:function(){document.addEventListener("keydown",this.keydownHandler)}},{key:"search",value:function(e){var t=new C(new m(e,{limit:50}));t.fetchIfApplicable(this.searchCallback),this.setState({mode:"slideshow",postManager:t})}},{key:"searchCallback",value:function(){this.setState({mode:"slideshow",currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}},{key:"searchEscape",value:function(){this.setState({mode:"slideshow"})}},{key:"slideshowEscape",value:function(){this.setState({mode:"search"})}},{key:"slideshowNext",value:function(){this.state.postManager.next(),this.setState({currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}},{key:"slideshowPrev",value:function(){this.state.postManager.prev(),this.setState({currentCache:this.state.postManager.getCachePosts(10,5),slideshowPost:this.state.postManager.getCurrentPost()})}}]),s}(a.a.Component);x.missingPost=new f(0,E.a,E.a,"png","#");var O=x;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(O,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[10,1,2]]]);
//# sourceMappingURL=main.1aaa5ad8.chunk.js.map